<div class="container-height">
  <div *ngIf="showInvoice">
    <div
      *ngIf="
        (feesBox == true ||
          feesBox1 == true ||
          feesBox2 == true ||
          feesBox3 == true) &&
        invStatus == 'UNPAID'
      "
      class="overlayInv"
    ></div>
    <div
      *ngIf="invStatus == 'PAID[PARTIAL]'"
      class="paid-header h2-strong bg-g25 text-g200"
    >
      <!-- PAID[PARTIAL] -->
      Partially paid
      <img
        (click)="closeModal()"
        class="close-btn"
        src="assets/img/removeIcon.png"
      />
    </div>
    <div
      *ngIf="invStatus != 'PAID[PARTIAL]'"
      class="paid-header h2-strong bg-s20 text-g200"
    >
      <img
        (click)="closeModal()"
        class="close-btn"
        src="assets/img/removeIcon.png"
      />
    </div>

    <div class="invoice-container">
      <div class="d-flex justify-content-between mb-2 inv-margin">
        <div>
          <div class="">
            <h3 class="modal-title" *ngIf="taxRate == 0">INVOICE</h3>
            <h3 class="modal-title" *ngIf="taxRate > 0">TAX INVOICE</h3>
            <div class="pt-4">
              <!-- <label class="id-label">Invoice ID</label>
                  <label class="mr-auto mb-0 body-l">{{ refInvID }}</label> -->
              <label class="mb-2 text-c300 light-body-l">
                <span class="body-l text-c300">Invoice No:</span>
                {{
                  refInvID.length > 50
                    ? (refInvID | slice: 0:50) + '....'
                    : refInvID
                }}
              </label>
            </div>
            <div>
              <label class="body-l text-c300">{{ registration }}</label>
              <!-- <label class="mr-auto mb-0 body-l">{{ registration }}</label> -->
            </div>
            <div class="p-0" *ngIf="custDetail.user">
              <label class="body-l mb-0 text-c300"
                >Bill to:
                <span class="p2 light-body-l text-c300">{{
                  custDetail.user.preferredName
                    ? custDetail.user.preferredName
                    : custDetail.user.email
                }}</span></label
              >
              <p class="light-body-l label-height mb-0 text-c300">
                <span *ngIf="custDetail.user && custDetail.user.email">{{
                  custDetail.user.email
                }}</span>
                <span
                  class="text-c100"
                  *ngFor="let mail of custDetail.user.guardians"
                  >{{ mail.email }}</span
                >
                <span
                  *ngIf="
                    custDetail.user.email == '' &&
                    custDetail.user.guardians?.length == 0
                  "
                  >-</span
                >
              </p>
            </div>
            <div class="d-flex pt-4" *ngIf="custDetail.user">
              <div class="pr-5">
                <label class="body-l text-c300">Invoice date</label>
                <p class="light-body-l mb-0 text-c300">{{ updatedDate }}</p>
              </div>
              <div class="p-0">
                <label class="body-l text-c300">Due date</label>
                <p class="light-body-l mb-0 text-c300">{{ dueDate }}</p>
              </div>
            </div>
          </div>
        </div>
        <div class="alignRight">
          <div class="logo-wrapper">
            <img src="{{ logo }}" />
          </div>
          <div class="pt-4">
            <h5 *ngIf="invoiceInfo.companyName != ''" class="body-l">
              {{ invoiceInfo.companyName }}
            </h5>
            <h5 *ngIf="invoiceInfo.companyName == ''" class="body-l mb-0">
              -
            </h5>
            <!-- <div>
              <label class="body-l semibold">{{ registration }}</label> -->
            <!-- <label class="mr-auto mb-0 body-l">{{ registration }}</label> -->
            <!-- </div> -->
            <div class="d-flex">
              <div class="address pl-zero">
                <p
                  *ngIf="
                    invoiceInfo.address != '' ||
                    invoiceInfo.address != undefined
                  "
                  class="light-body-l inv-address mb-2 text-c300"
                >
                  {{ invoiceInfo.address }}
                </p>
                <p *ngIf="invoiceInfo.address == ''" class="body-l mb-2">
                  -
                </p>
              </div>
            </div>
            <p class="body-l mb-0 pRight">{{ invoiceInfo.email }}</p>
            <p></p>
          </div>
        </div>
      </div>

      <div class="d-flex body-l fees-header bg-s20 inv-margin">
        <div class="col-md-5 p-0">Item</div>
        <div class="col-md-1 p-0 text-right">Quantity</div>
        <div class="col-md-2 p-0 text-right">Unit price</div>
        <div class="col-md-2 p-0 text-right">
          Tax
          <!-- <span *ngIf="invTaxName">({{ invTaxName }})</span> -->
        </div>
        <div class="col-md-2 p-0 text-right">Amount</div>
      </div>
      <div>
        <div class="cfee-wrapper">
          <div class="d-flex inv-courseFee">
            <!-- <div class="cFee-w"></div> -->
            <div class="d-flex w-100">
              <div class="col-md-5 p-0 body-l text-c300">Course fee</div>
              <div class="col-md-1 p-0 text-right light-body-l">1</div>
              <div class="col-md-2 p-0 text-right light-body-l">
                <div
                  *ngIf="feesBox == true && invStatus == 'UNPAID'"
                  class="popup-box price-box text-left"
                >
                  <div id="rectangle"></div>
                  <div class="p-3">
                    <h5 class="light-body-l">CourseFee</h5>
                    <div class="d-flex popup-input">
                      <div class="input-sign body-l text-c100">
                        {{ invCurrency.sign }}
                      </div>
                      <!--  oninput="validity.valid||(value='')" -->
                      <input
                        name="discount"
                        class="w-100 input-txt"
                        placeholder="0"
                        [(ngModel)]="value.courseFee"
                        (keypress)="isDecimalValue($event, value.courseFee)"
                        type="text"
                        appNumericValidation
                      />
                    </div>
                  </div>
                </div>

                <div
                  *ngIf="feesBox == true && invStatus == 'UNPAID'"
                  class="d-flex btns-wrap"
                >
                  <button
                    type="submit"
                    class="btn popup-btn"
                    (click)="cancelPopup('courseFee')"
                  >
                    <span class="closemark">
                      <div class="closemark_stem"></div>
                      <div class="closemark_kick"></div>
                    </span>
                  </button>
                  <button
                    type="submit"
                    class="btn"
                    (click)="updateCfee(value.courseFee)"
                    [disabled]="
                      value.courseFee == 0 ||
                      value.courseFee == undefined ||
                      value.courseFee == '' ||
                      value.courseFee == invoice.courseFee.fee
                    "
                  >
                    <span class="checkmark">
                      <div class="checkmark_stem"></div>
                      <div class="checkmark_kick"></div>
                    </span>
                  </button>
                </div>
                <p
                  class="mb-0 addPointer"
                  (click)="showPopup('courseFee', invoice.courseFee.fee)"
                >
                  {{ invCurrency.sign }} {{ invoice.courseFee.fee | financial }}
                </p>
              </div>
              <div class="col-md-2 p-0 text-right light-body-l">
                {{ invoice.tax.rate }} %
                <!-- <span
                  *ngIf="data.courseFee.taxInclusive == true"
                  class="tax-status"
                  >(inclusive)</span
                >
                <span
                  *ngIf="data.courseFee.taxInclusive == false"
                  class="tax-status"
                  >(exclusive)</span
                > -->
              </div>
              <!-- <div class="col-md-2 p-0 text-right light-body-l"   *ngIf="data.courseFee.taxInclusive == true">
                {{ invCurrency.sign }}{{ data.courseFee.fee }}
              </div>
              <div class="col-md-2 p-0 text-right light-body-l"   *ngIf="data.courseFee.taxInclusive == false">
                  {{ invCurrency.sign }}{{ data.courseFee.amount }}
                </div> -->
              <div class="col-md-2 p-0 text-right light-body-l">
                {{ invCurrency.sign }}
                {{ invoice.courseFee.amount | financial }}
              </div>
            </div>
          </div>
          <div class=" body-m text-c100">
            {{ invoiceCourse.name }}
            <div>
              <span *ngIf="invoiceCourse.startDate"
                >From: {{ invoiceCourse.startDate | utcDate }}</span
              ><span class="pl-3" *ngIf="invoiceCourse.endDate"
                >To: {{ invoiceCourse.endDate | utcDate }}</span
              ><span class="pl-3" *ngIf="invoiceCourse.lessonCount"
                >{{ invoiceCourse.lessonCount }} lessons</span
              >
            </div>
          </div>
          <!-- course fee exit discount  -->
          <div class="col-md-5 dis-courseFee p-0">
            <div
              *ngIf="
                feesBox2 == true &&
                invStatus == 'UNPAID' &&
                iscDiscount == false
              "
              class="popup-box discount-fee"
            >
              <div id="rectangle-discount"></div>
              <div class="p-3">
                <h5 class="light-body-l">Discount</h5>
                <div class="d-flex popup-input">
                  <div class="input-sign body-l text-c100">
                    {{ invCurrency.sign }}
                  </div>
                  <input
                    type="text"
                    name="discount"
                    class="w-100 input-txt"
                    placeholder="0"
                    [(ngModel)]="cDiscount.dValue"
                    (keypress)="isDecimalValue($event, value.courseFee)"
                    appNumericValidation
                  />
                </div>
              </div>
            </div>
            <div
              *ngIf="
                feesBox2 == true &&
                invStatus == 'UNPAID' &&
                iscDiscount == false
              "
              class="d-flex btns-wrap btns-wrap-dis"
            >
              <button
                type="submit"
                class="btn popup-btn"
                (click)="cancelPopup3()"
              >
                <span class="closemark">
                  <div class="closemark_stem"></div>
                  <div class="closemark_kick"></div>
                </span>
              </button>
              <button
                type="submit"
                class="btn popup-btn"
                (click)="addnewDiscount('courseFee-dis')"
                [disabled]="
                  cDiscount.dValue == undefined || cDiscount.dValue == ''
                "
              >
                <span class="checkmark">
                  <div class="checkmark_stem"></div>
                  <div class="checkmark_kick"></div>
                </span>
              </button>
            </div>
            <button
              class="newdiscount-btn body-l text-b100 bg-s0"
              (click)="showDiscountPopup('courseFee-dis')"
              *ngIf="invStatus == 'UNPAID' && iscDiscount == false"
            >
              Add discount
            </button>
          </div>
          <!-- add discount in exit course fee first time-->

          <div class="d-flex inv-courseFee" *ngIf="iscDiscount">
            <!-- <div class="cFee-w"></div> -->
            <div class="d-flex w-100">
              <div class="col-md-5 p-0 light-body-l discount-name ">
                Discount:
                <span class="mb-0 ml-1 text-b100">
                  {{ invCurrency.sign }} {{ cDiscount.value | financial }}
                </span>
                <span
                  class="removeDis"
                  (click)="removeDiscount('courseFee')"
                  *ngIf="invStatus == 'UNPAID'"
                  >Remove</span
                >
                <!-- <div
                *ngIf="
                  feesBox2 == true &&
                  invStatus == 'UNPAID' &&
                  iscDiscount == true
                "
                class="popup-box"
              >
                <div id="rectangle"></div>
                <div class="p-3">
                  <h5>Discount</h5>
                  <div class="d-flex popup-input">
                    <div class="input-sign">
                      {{ invCurrency.sign }}
                    </div>
                    <input
                      type="number"
                      name="discount"
                      class="w-100 input-txt"
                      placeholder="0"
                      [(ngModel)]="cDiscount.dValue"
                      min="0"
                      oninput="validity.valid||(value='')"
                    />
                  </div>
                </div>
                </div>
                <div
                  *ngIf="
                    feesBox2 == true &&
                    invStatus == 'UNPAID' &&
                    iscDiscount == true
                  "
                  class="d-flex btns-wrap"
                >
                  <button type="submit" class="btn" (click)="cancelPopup3()">
                    <span class="closemark">
                      <div class="closemark_stem"></div>
                      <div class="closemark_kick"></div>
                    </span>
                  </button>
                  <button
                    type="submit"
                    class="btn"
                    (click)="addnewDiscount('courseFee-dis')"
                    [disabled]="
                      cDiscount.dValue == undefined || cDiscount.dValue == ''
                    "
                  >
                    <span class="checkmark">
                      <div class="checkmark_stem"></div>
                      <div class="checkmark_kick"></div>
                    </span>
                  </button>
                </div> -->
              </div>
              <div
                class="col-md-1 p-0 text-right light-body-l discount-number"
              ></div>
              <div class="col-md-2 p-0 text-right light-body-l discount-number">
                <p class="mb-0" (click)="showDiscountPopup('courseFee-dis')">
                  {{ invCurrency.sign }} {{ cDiscount.value | financial }}
                </p>
                <div
                  *ngIf="
                    feesBox2 == true &&
                    invStatus == 'UNPAID' &&
                    iscDiscount == true
                  "
                  class="popup-box"
                >
                  <div id="rectangle"></div>
                  <div class="p-3">
                    <h5 class="light-body-l text-left">Discount:</h5>
                    <div class="d-flex popup-input">
                      <div class="input-sign body-l text-c100">
                        {{ invCurrency.sign }}
                      </div>
                      <input
                        type="text"
                        name="discount"
                        class="w-100 input-txt"
                        placeholder="0"
                        [(ngModel)]="cDiscount.dValue"
                        (keypress)="isDecimalValue($event, value.courseFee)"
                        appNumericValidation
                      />
                    </div>
                  </div>
                </div>
                <div
                  *ngIf="
                    feesBox2 == true &&
                    invStatus == 'UNPAID' &&
                    iscDiscount == true
                  "
                  class="d-flex btns-wrap"
                >
                  <button
                    type="submit"
                    class="btn popup-btn"
                    (click)="cancelPopup3()"
                  >
                    <span class="closemark">
                      <div class="closemark_stem"></div>
                      <div class="closemark_kick"></div>
                    </span>
                  </button>
                  <button
                    type="submit"
                    class="btn popup-btn"
                    (click)="addnewDiscount('courseFee-dis')"
                    [disabled]="
                      cDiscount.dValue == undefined || cDiscount.dValue == ''
                    "
                  >
                    <span class="checkmark">
                      <div class="checkmark_stem"></div>
                      <div class="checkmark_kick"></div>
                    </span>
                  </button>
                </div>
              </div>
              <div class="col-md-2 p-0 text-right light-body-l discount-number">
                {{ cDiscount.tax }} %
              </div>
              <div class="col-md-2 p-0 text-right light-body-l discount-number">
                {{ invCurrency.sign }} {{ cDiscount.amount | financial }}
              </div>
            </div>
          </div>
        </div>
        <!-- <hr class="invoice-hr" /> -->

        <!-- new item  -->
        <div
          class="d-flex new-item-box"
          *ngFor="let obj of newItemArr; let i = index"
        >
          <div class="row-icon cursor-on" (click)="hideInvoiceRow(obj)">
            <img
              *ngIf="invStatus == 'UNPAID'"
              src="./assets/images/withdraw-ico@2x.png"
            />
          </div>
          <div class="d-flex flex-column w-100 mlr-15 item-row">
            <div class="d-flex flex-row new-item">
              <div class="col-md-5 light-body-l p-0">
                <input
                  class="form-control price-txt itemName p-0"
                  placeholder="Item Name"
                  (input)="this.newItemArr[i].name = $event.target.value"
                  [value]="obj.name"
                />
              </div>
              <div class="col-md-1 text-right light-body-l p-0">1</div>

              <div
                class="col-md-2 text-right light-body-l"
                style="
                padding-right: 0;
            "
              >
                <div
                  *ngIf="feesBox1 == true && activeFeeBoxId == i"
                  class="popup-box price-box text-left"
                >
                  <div id="rectangle"></div>
                  <div class="p-3">
                    <h5 class="light-body-l">ItemFee</h5>
                    <div class="d-flex popup-input">
                      <div class="input-sign body-l text-c100">
                        {{ invCurrency.sign }}
                      </div>
                      <input
                        class="w-100 input-txt"
                        placeholder="Unit Price"
                        type="text"
                        (input)="inputUnitPrice($event.target.value, i)"
                        (input)="unitPrice = $event.target.value"
                        [ngModel]="obj.fee"
                        (keypress)="isDecimalValue($event, obj.fee)"
                        appNumericValidation
                      />
                      <!-- <input
                      name="discount"
                      class="w-100 input-txt"
                      placeholder="0"
                      [(ngModel)]="value.courseFee"
                      type="text"
                      appNumericValidation
                    /> -->
                    </div>
                  </div>
                </div>

                <div
                  *ngIf="feesBox1 == true && activeFeeBoxId == i"
                  class="d-flex btns-wrap"
                >
                  <button
                    type="submit"
                    class="btn popup-btn"
                    (click)="cancelPopup2(i)"
                  >
                    <span class="closemark">
                      <div class="closemark_stem"></div>
                      <div class="closemark_kick"></div>
                    </span>
                  </button>
                  <button
                    type="submit"
                    class="btn popup-btn"
                    (click)="addCurseFee(i)"
                    [disabled]="
                      unitPrice == undefined ||
                      unitPrice == '' ||
                      unitPrice == 0
                    "
                  >
                    <span class="checkmark">
                      <div class="checkmark_stem"></div>
                      <div class="checkmark_kick"></div>
                    </span>
                  </button>
                </div>
                <p class="mb-0 addPointer" (click)="showPopup1(i)">
                  {{ invCurrency.sign }} {{ obj.fee | financial }}
                </p>
              </div>
              <div
                class="col-md-2 text-right light-body-l p-0"
                [ngClass]="{ addType: obj.isDefault == true }"
                *ngIf="invStatus == 'UNPAID'"
              >
                <div *ngIf="obj.taxtype != 'No Tax'">{{ obj.tax }}%</div>
                <div class="noTax" *ngIf="obj.taxtype == 'No Tax'">
                  0%
                </div>
                <div *ngIf="obj.isDefault == false">
                  <button
                    class="taxOpt-wrap body-l text-b100 bg-s20"
                    (click)="showDropdown(i)"
                  >
                    <span>{{ obj.taxtype }}</span
                    ><i class="fa fa-chevron-down downIcon"></i>
                  </button>
                  <div
                    class="dropdown-wrap"
                    *ngIf="isShowDown == true && i == activeId"
                  >
                    <!-- <div *ngIf="locationMenuShow == false" class="carret"></div> -->
                    <ul class="taxOpt-dropdown bg-s0 caption text-c100">
                      <li>
                        <div
                          class="w-100 light-body-l text-b100"
                          (click)="chooseTaxOption('Exclusive', i)"
                        >
                          Exclusive
                        </div>
                      </li>
                      <li>
                        <div
                          class="w-100 light-body-l text-b100"
                          (click)="chooseTaxOption('Inclusive', i)"
                        >
                          Inclusive
                        </div>
                      </li>
                      <li>
                        <div
                          class="w-100 light-body-l text-b100"
                          (click)="chooseTaxOption('No Tax', i)"
                        >
                          No Tax
                        </div>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              <div
                class="col-md-2 p-0 text-right light-body-l"
                *ngIf="invStatus != 'UNPAID'"
              >
                {{ invoice.tax.rate }} %
                <!-- <span
                  *ngIf="data.courseFee.taxInclusive == true"
                  class="tax-status"
                  >(inclusive)</span
                >
                <span
                  *ngIf="data.courseFee.taxInclusive == false"
                  class="tax-status"
                  >(exclusive)</span
                > -->
              </div>
              <!-- <div class="col-md-2 text-right light-body-l">
                  <input
                    class="form-control amount-txt"
                    placeholder="Amount"
                    type="number"
                    (input)="this.newItemArr[i].amount = $event.target.value"
                    [value]="obj.amount"
                  />
                </div> -->
              <div class="col-md-2 text-right light-body-l p-0">
                {{ invCurrency.sign }} {{ obj.amount | financial }}
              </div>
            </div>
            <!-- new item discount first time  -->
            <div class="col-md-5 p-0" *ngIf="obj.isDiscount == false">
              <!--   new item discount first time -->
              <div>
                <div
                  *ngIf="
                    feesBox3 == true &&
                    activeFeeBoxId == i &&
                    obj.isDiscount == false
                  "
                  class="popup-box discount-fee"
                >
                  <div id="rectangle-discount"></div>
                  <div class="p-3">
                    <h5 class="light-body-l">Discount</h5>
                    <div class="d-flex popup-input">
                      <div class="input-sign body-l text-c100">
                        {{ invCurrency.sign }}
                      </div>
                      <input
                        type="text"
                        name="discount"
                        class="w-100 input-txt"
                        placeholder="0"
                        appNumericValidation
                        (input)="unitPrice = $event.target.value"
                        (input)="inputDiscount($event.target.value, i)"
                        (keypress)="isDecimalValue($event, obj.discount.dValue)"
                        [value]="obj.discount.dValue"
                      />
                    </div>
                  </div>
                </div>

                <div
                  *ngIf="
                    feesBox3 == true &&
                    activeFeeBoxId == i &&
                    obj.isDiscount == false
                  "
                  class="d-flex btns-wrap btns-wrap-dis"
                >
                  <button
                    type="submit"
                    class="btn popup-btn"
                    (click)="cancelPopup4()"
                  >
                    <span class="closemark">
                      <div class="closemark_stem"></div>
                      <div class="closemark_kick"></div>
                    </span>
                  </button>
                  <button
                    type="submit popup-btn"
                    class="btn"
                    (click)="addnewDiscount('newitem-dis', i)"
                    [disabled]="unitPrice == undefined || unitPrice == ''"
                  >
                    <span class="checkmark">
                      <div class="checkmark_stem"></div>
                      <div class="checkmark_kick"></div>
                    </span>
                  </button>
                </div>
              </div>

              <button
                class="newdiscount-btn text-b100 bg-s0 body-l"
                (click)="showDiscountPopup('newitem-dis', i)"
                *ngIf="invStatus == 'UNPAID' && obj.isDiscount == false"
              >
                Add discount
              </button>
            </div>
            <!-- end new item exit -->
            <!-- new item discount exit  -->
            <div
              class="d-flex flex-row new-item"
              style="padding-top:5px"
              *ngIf="obj.isDiscount"
            >
              <div class="col-md-5 light-body-l p-0 discount-name">
                Discount:
                <span class="mb-0 ml-1 text-b100 ">
                  {{ invCurrency.sign }} {{ obj.discount.value | financial }}
                </span>
                <span
                  class="removeDis"
                  (click)="removeDiscount('newitem-dis', obj, i)"
                  *ngIf="invStatus == 'UNPAID'"
                  >Remove</span
                >
              </div>
              <div class="col-md-1 text-right light-body-l p-0"></div>
              <div
                class="col-md-2 text-right light-body-l discount-number"
                style="
                  padding-right: 0;
              "
              >
                <!-- <div
                  *ngIf="feesBox1 == true && activeFeeBoxId == i"
                  class="popup-box price-box text-left"
                >
                  <div id="rectangle"></div>
                  <div class="p-3">
                    <h5>CourseFee</h5>
                    <div class="d-flex popup-input">
                      <div class="input-sign">
                        {{ invCurrency.sign }}
                      </div>
                      <input
                        class="w-100 input-txtaddCurseFee"
                        placeholder="Unit Price"
                        type="number"
                        min="0"
                        oninput="validity.valid||(value='')"
                        (input)="inputUnitPrice($event.target.value, i)"
                        (input)="unitPrice = $event.target.value"
                        [value]="obj.fee"
                      />
                    </div>
                  </div>
                </div> -->

                <div>
                  <div
                    *ngIf="
                      feesBox3 == true &&
                      activeFeeBoxId == i &&
                      obj.isDiscount == true
                    "
                    class="popup-box"
                  >
                    <div id="rectangle"></div>
                    <div class="p-3">
                      <h5 class="light-body-l">Discount</h5>
                      <div class="d-flex popup-input">
                        <div class="input-sign body-l text-c100">
                          {{ invCurrency.sign }}
                        </div>
                        <input
                          type="text"
                          name="discount"
                          class="w-100 input-txt addCurseFee"
                          placeholder="0"
                          appNumericValidation
                          (input)="unitPrice = $event.target.value"
                          (input)="inputDiscount($event.target.value, i)"
                          [value]="obj.discount.dValue"
                        />
                      </div>
                    </div>
                  </div>

                  <div
                    *ngIf="feesBox3 == true && activeFeeBoxId == i"
                    class="d-flex btns-wrap"
                  >
                    <button
                      type="submit"
                      class="btn addPointer"
                      (click)="cancelPopup4()"
                    >
                      <span class="closemark">
                        <div class="closemark_stem"></div>
                        <div class="closemark_kick"></div>
                      </span>
                    </button>
                    <button
                      type="submit"
                      class="btn addPointer"
                      (click)="addnewDiscount('newitem-dis', i)"
                      [disabled]="unitPrice == undefined || unitPrice == ''"
                    >
                      <span class="checkmark">
                        <div class="checkmark_stem"></div>
                        <div class="checkmark_kick"></div>
                      </span>
                    </button>
                  </div>
                </div>
                <p
                  class="mb-0 addPointer"
                  (click)="showDiscountPopup('newitem-dis', i)"
                >
                  {{ invCurrency.sign }} {{ obj.discount.value | financial }}
                </p>
              </div>
              <div class="col-md-2 text-right light-body-l p-0 discount-number">
                <div *ngIf="obj.discount.type != 'No Tax'">
                  {{ obj.discount.tax }}%
                </div>
                <div *ngIf="obj.discount.type == 'No Tax'"></div>
              </div>

              <!-- <div class="col-md-2 text-right light-body-l">
                    <input
                      class="form-control amount-txt"
                      placeholder="Amount"
                      type="number"
                      (input)="this.newItemArr[i].amount = $event.target.value"
                      [value]="obj.amount"
                    />
                  </div> -->
              <div class="col-md-2 text-right light-body-l p-0 discount-number">
                {{ invCurrency.sign }} {{ obj.discount.amount | financial }}
              </div>
            </div>
          </div>
          <!-- <hr class="invoice-hr" /> -->
        </div>
        <!-- <div class="inv-bordered">
          <div *ngIf="hideReg == false" class="d-flex inv-row">
            <div class="row-icon cursor-on" (click)="hideInvoiceRow('reg')">
              <img src="./assets/images/withdraw-ico@2x.png" />
            </div>
            <div class="d-flex w-100 b-bottom mlr-15">
              <div class="col-md-5 p-0 light-body-l">
                Registration Fee
              </div>
              <div class="col-md-1 p-0 text-right light-body-l">1</div>
              <div class="col-md-2 p-0 text-right light-body-l">
                <p class="mb-0">{{ data.registrationFee.fee }}</p>
              </div>
              <div class="col-md-2 p-0 text-right light-body-l">
                {{ data.registrationFee.tax }}
                <span
                  *ngIf="data.registrationFee.taxInclusive == true"
                  class="tax-status"
                  >(inclusive)</span
                >
                <span
                  *ngIf="data.registrationFee.taxInclusive == false"
                  class="tax-status"
                  >(exclusive)</span
                >
              </div>
              <div class="col-md-2 p-0 text-right light-body-l">
                {{ invCurrency.sign }}{{ data.registrationFee.amount }}
              </div>
            </div>
          </div>
          <div *ngIf="hideMisc == false" class="d-flex inv-row">
            <div class="row-icon cursor-on" (click)="hideInvoiceRow('misc')">
              <img src="./assets/images/withdraw-ico@2x.png" />
            </div>
            <div class="d-flex w-100 b-bottom mlr-15">
              <div class="col-md-5 p-0 light-body-l">
                Miscellaneous fee
              </div>
              <div class="col-md-1 p-0 text-right light-body-l">1</div>
              <div class="col-md-2 p-0 text-right light-body-l">
                <p class="mb-0">{{ data.miscFee.fee }}</p>
              </div>
              <div class="col-md-2 p-0 text-right light-body-l">
                {{ data.miscFee.tax }}
                <span
                  *ngIf="data.miscFee.taxInclusive == true"
                  class="tax-status"
                  >(inclusive)</span
                >
                <span
                  *ngIf="data.miscFee.taxInclusive == false"
                  class="tax-status"
                  >(exclusive)</span
                >
              </div>
              <div class="col-md-2 p-0 text-right light-body-l">
                {{ invCurrency.sign }} {{ data.miscFee.amount }}
              </div>
            </div>
          </div>
          <div *ngIf="hideDeposit == false" class="d-flex inv-row">
            <div class="row-icon cursor-on" (click)="hideInvoiceRow('deposit')">
              <img src="./assets/images/withdraw-ico@2x.png" />
            </div>
            <div class="d-flex w-100 b-bottom mlr-15">
              <div class="col-md-5 p-0 light-body-l">Deposit</div>
              <div class="col-md-1 p-0 text-right light-body-l">1</div>
              <div class="col-md-2 p-0 text-right light-body-l">
                <p class="mb-0">{{ data.deposit }}</p>
              </div>
              <div class="col-md-2 p-0 text-right light-body-l"></div>
              <div class="col-md-2 p-0 text-right light-body-l">
                {{ invCurrency.sign }} {{ data.deposit }}
              </div>
            </div>
          </div>
        </div> -->

        <div class="d-flex inv-all-amt">
          <div class="w-50">
            <!-- <button
              class="newItem-btn"
              (click)="addnewItem()"
              *ngIf="invStatus == 'UNPAID'"
            >
              Add New Item
            </button> -->
            <div
              class="d-flex newItem-btn"
              (click)="addnewItem()"
              *ngIf="invStatus == 'UNPAID'"
            >
              <span class="addIcn-wrap">
                <img src="assets/img/plus.png" />
              </span>
              <span class="pl-3 newItem-btn-txt body-l text-b100 bg-s0"
                >Add new item</span
              >
            </div>
          </div>
          <div class="w-50">
            <div class="d-flex pad-10 ">
              <!-- <div class="col-md-8 p-0 text-center">Sub total</div> -->
              <div class="col-md-8 d-flex p-0">
                <div class="col-sm-7 text-right p-0 light-body-l text-c300">
                  Sub total
                </div>
                <div class="col-sm-5 p-0"></div>
              </div>
              <div class="col-md-4 text-right p-0 light-body-l text-c300">
                {{ invCurrency.sign }} {{ subTotal | financial }}
              </div>
            </div>
            <div class="d-flex pad-10 light-body-l">
              <div class="col-md-8 d-flex p-0">
                <div class="col-sm-7 text-right p-0 light-body-l text-c300">
                  Tax
                </div>
                <div class="col-sm-5 p-0 text-right"></div>
              </div>
              <div class="col-md-4 text-right p-0 light-body-l text-c300">
                {{ invCurrency.sign }} {{ totalTax | financial }}
              </div>
            </div>
            <div class="d-flex pad-10 light-body-l">
              <div class="col-md-8 d-flex p-0">
                <div class="col-sm-7 text-right p-0 light-body-l text-c300">
                  Total discount
                </div>
                <div class="col-sm-5 p-0 text-right"></div>
              </div>
              <div class="col-md-4 text-right p-0 light-body-l text-c300">
                {{ invCurrency.sign }} {{ totalDiscount | financial }}
              </div>
            </div>
            <div class="d-flex pad-10 light-body-l">
              <div class="col-md-8 d-flex p-0">
                <div class="col-sm-7 text-right p-0 light-body-l text-c300">
                  Discount tax
                </div>
                <div class="col-sm-5 p-0 text-right"></div>
              </div>
              <div class="col-md-4 text-right p-0 light-body-l text-c300">
                {{ invCurrency.sign }} {{ totalDiscounTax | financial }}
              </div>
            </div>
            <div class="d-flex amount-result pad-10 mb-4 mt-3 bg-y50">
              <div class="col-md-8 d-flex p-0">
                <div class="col-sm-7 text-right p-0 body-l text-c300">
                  Amount due
                </div>
                <div class="col-sm-5 text-right p-0"></div>
              </div>
              <div class="col-md-4 text-right body-l text-c300">
                {{ invCurrency.sign }} {{ total | financial }}
              </div>
            </div>
          </div>
        </div>

        <!-- <div class="body-l">
          <p class="mb-0">
            Payments can be made via cash, cheque or bank transfer.
          </p>
          <label class="mb-0">Bank transfer details:</label>
          <div>
            Beneficiary: Sports Lab
          </div>
          <div>
            Acc No: 12345678
          </div>
          <div class="mb-3">
            Code: xx123
          </div>
        </div> -->
        <div *ngIf="invPayment?.length > 0" class="inv-margin">
          <div class="d-flex">
            <div class="col-md-4 p-0">
              <label class="body-l">Payment date</label>
            </div>
            <div class="col-md-4 p-0">
              <label class="body-l">Payment method</label>
            </div>
            <div class="col-md-4 p-0">
              <label class="body-l">Amount</label>
            </div>
          </div>
          <div *ngFor="let payment of invPayment">
            <div *ngIf="payment.status == 'COMPLETE'" class="d-flex pb-4">
              <div class="col-md-4 p-0">
                <p class="body-l">
                  {{ payment.updatedDate | dateFormat }}
                </p>
              </div>
              <div class="col-md-4 p-0">
                <div class="d-flex">
                  <!-- <img style="width: 100%;" src="../assets/img/mastercardlogo.jpg"> -->
                  <!-- <div style="width: 55px;">

                    <i class="fa fa-credit-card" style="font-size: 30px;"></i>
                  </div> -->
                  <div
                    class="pl-3"
                    *ngIf="payment.brandName || payment.cardNumber"
                  >
                    <label class="mb-0 c-label body-l text-c100">{{
                      payment.brandName
                    }}</label>
                    <div class="d-flex light-body-l">
                      {{ payment.cardNumber }}
                    </div>
                  </div>
                  <div
                    class="c-label body-l text-c100"
                    *ngIf="payment.paymentMethod == 0"
                  >
                    {{ paymentList[0]?.name }}
                  </div>
                  <div
                    class="c-label body-l text-c100"
                    *ngIf="payment.paymentMethod == 1"
                  >
                    {{ paymentList[1]?.name }}
                  </div>
                  <div
                    class="c-label body-l text-c100"
                    *ngIf="payment.paymentMethod == 2"
                  >
                    {{ paymentList[2]?.name }}
                  </div>
                  <div
                    class="c-label body-l text-c100"
                    *ngIf="payment.paymentMethod == 3"
                  >
                    {{ paymentList[3]?.name }}
                  </div>
                </div>
              </div>
              <div class="col-md-4 p-0 d-flex body-l">
                <span
                  >{{ invCurrency.sign }} {{ payment.amount | financial }}</span
                >
                <!-- <div>{{ payment.amount }}</div> -->
              </div>
            </div>
          </div>
        </div>
        <!-- <div class="body-l">
          <textarea
            *ngIf="invoiceInfo.invoiceNote != ''"
            rows="1"
            type="text"
            class="invnote-readonly"
            id="invNote"
            [(ngModel)]="invoiceInfo.invoiceNote"
            #invNote="ngModel"
            name="invNote"
            readonly
          ></textarea>
        </div> -->
        <div class="invnote-readonly  pb-3 body-m text-c100">
          {{ invoiceInfo.invoiceNote }}
        </div>
      </div>
    </div>
    <div class="modal-footer justify-content-between">
      <div class="d-flex">
        <!-- <button
          type="button"
          class="btn invModal-cancel text-c300 body-l bg-s0"
          (click)="closeModal('closeInv')"
        >
          Close
        </button> -->
        <div style="position: relative;">
          <div (click)="openActions()" class="action text-c300">
            Actions
            <img
              style="margin-left: 8px;"
              src="../../../assets/icons/drop-down.svg"
            />
          </div>
          <div *ngIf="actionFlag" class="action-dropdown">
            <div (click)="closeModal()" class="body-m text-c300 cursor">
              Close
            </div>
            <div
              (click)="invoiceDeleteModal(invoice_delete)"
              class="body-m text-r100 cursor"
            >
              Delete invoice
            </div>
          </div>
        </div>
        <div class="l-border">
          <button
            class="btn btn-print cursor-on"
            (click)="printInvoice()"
            [disabled]="isEditInv == true"
          >
            <img src="./assets/images/print@2x.png" />
          </button>
        </div>
      </div>
      <div *ngIf="custDetail.user">
        <button
          *ngIf="isEditInv == false"
          class="btn send-btn body-l bg-s20 text-c300"
          [disabled]="
            custDetail.user.email == '' &&
            custDetail.user.guardians?.length == 0
          "
          (click)="sendInvoice()"
        >
          Send invoice
        </button>

        <div class="d-none" *ngIf="newItemArr.length > 0">
          {{ validateForm() }}
        </div>

        <!-- remove Save and PAY button disabled validation for user email and guardians (custDetail.user.email == '' &&
        custDetail.user.guardians?.length == 0) for staging urgent fix -->
        <button
          *ngIf="isEditInv == true"
          class="btn send-btn "
          [disabled]="isnewItemsValid == false"
          (click)="updateInvoice()"
        >
          Save
        </button>
        <button
          class="btn btn-submit body-l bg-b100 text-s0"
          [disabled]="isEditInv == true"
          (click)="showPayOption()"
        >
          PAY
        </button>
      </div>
    </div>
  </div>
  <div *ngIf="showPaidInvoice == true">
    <div
      *ngIf="
        feesBox == true ||
        feesBox1 == true ||
        feesBox2 == true ||
        feesBox3 == true
      "
      class="overlayInv"
    ></div>
    <div class="paid-header h2-strong bg-g25 text-g200">
      PAID
      <img
        (click)="closeModal()"
        class="close-btn"
        src="assets/img/removeIcon.png"
      />
    </div>
    <div class="invoice-container">
      <div class="d-flex justify-content-between mb-2 inv-margin">
        <div>
          <div class="">
            <h3 class="modal-title text-c300" *ngIf="taxRate == 0">INVOICE</h3>
            <h3 class="modal-title text-c300" *ngIf="taxRate > 0">
              TAX INVOICE
            </h3>
            <div class="pt-4">
              <!-- <label class="id-label">Invoice ID</label>
                    <label class="mr-auto mb-0 body-l">{{ refInvID }}</label> -->
              <label class="mb-2 text-c300 light-body-l">
                <span class="body-l">Invoice No:</span>
                {{
                  refInvID.length > 50
                    ? (refInvID | slice: 0:50) + '..'
                    : refInvID
                }}
                <!-- {{ refInvID }} -->
              </label>
            </div>
            <div>
              <label class="body-l">{{ registration }}</label>
              <!-- <label class="mr-auto mb-0 body-l">{{ registration }}</label> -->
            </div>
            <div class="p-0" *ngIf="custDetail.user">
              <label class="mb-0 text-c300 body-l"
                >Bill to:
                <span class="p2 light-body-l text-c300">{{
                  custDetail.user.preferredName
                }}</span></label
              >
              <p class="label-height mb-0 light-body-m text-c100">
                <span *ngIf="custDetail.user && custDetail.user.email">{{
                  custDetail.user.email
                }}</span>
                <span *ngFor="let mail of custDetail.user.guardians">{{
                  mail.email
                }}</span>
                <span
                  *ngIf="
                    custDetail.user.email == '' &&
                    custDetail.user.guardians?.length == 0
                  "
                  >-</span
                >
              </p>
            </div>
            <div class="d-flex pt-4" *ngIf="custDetail.user">
              <div class="pr-5">
                <label class="body-l text-c300">Invoice date</label>
                <p class="body-l mb-0 text-c300">{{ updatedDate }}</p>
              </div>
              <div class="p-0">
                <label class="body-l text-c300">Due date</label>
                <p class="body-l mb-0 text-c300">{{ dueDate }}</p>
              </div>
            </div>
          </div>
        </div>
        <div class="alignRight">
          <div class="logo-wrapper">
            <img src="{{ logo }}" />
          </div>
          <div class="pt-4">
            <h5 *ngIf="invoiceInfo.companyName != ''" class="body-l">
              {{ invoiceInfo.companyName }}
            </h5>
            <h5 *ngIf="invoiceInfo.companyName == ''" class="body-l mb-0">
              -
            </h5>
            <!-- <div>
              <label class="body-l semibold">{{ registration }}</label> -->
            <!-- <label class="mr-auto mb-0 body-l">{{ registration }}</label> -->
            <!-- </div> -->
            <div class="d-flex">
              <div class="address pl-zero">
                <p
                  *ngIf="
                    invoiceInfo.address != '' ||
                    invoiceInfo.address != undefined
                  "
                  class="light-body-l inv-address mb-2 text-c300"
                >
                  {{ invoiceInfo.address }}
                </p>
                <p *ngIf="invoiceInfo.address == ''" class="body-l mb-2">
                  -
                </p>
              </div>
            </div>
            <p class="light-body-l mb-0 pRight">{{ invoiceInfo.email }}</p>
            <p></p>
          </div>
        </div>
      </div>
      <!-- <div class="d-flex pb-4">
          <div class="col-md-4 p-0 d-flex paid-amount">
            <span>{{ currency.invCurrencySign }}</span>
            <div>{{ total }}</div>
          </div>
          <div class="col-md-4">
            <label class="body-l">Payment Date</label>
            <p class="body-l">-</p>
          </div>
          <div class="col-md-4">
            <label class="body-l">Payment method</label>
            <div class="d-flex">
              <div style="width: 55px;padding-top: 7px;">
                <img style="width: 100%;" src="../assets/img/mastercardlogo.jpg">
              </div>
              <div class="pl-3">
                <label class="mb-0 c-label">Mastercard</label>
                <div class="d-flex">
                  <div class="semibold dotted-text">
                    .... .... ....
                  </div>
                  <div class="semibold" style="font-size: 14px; color: #2e3d4d; padding-left: 6px;">8012</div>
                </div>
              </div>
            </div>
          </div>
        </div> -->

      <div class="d-flex body-l fees-header bg-s20 inv-margin">
        <div class="col-md-5 p-0 body-l text-c300">Item</div>
        <div class="col-md-1 p-0 text-right body-l text-c300">Quantity</div>
        <div class="col-md-2 p-0 text-right body-l text-c300">Unit price</div>
        <div class="col-md-2 p-0 text-right body-l text-c300">Tax</div>
        <div class="col-md-2 p-0 text-right body-l text-c300">Amount</div>
      </div>

      <div>
        <div class="p-0 m-0">
          <div class="cfee-wrapper">
            <!-- <div class="c-label pt-2">
              {{ invoiceCourse.name }}
              <div>
                <span>From: {{ invoiceCourse.startDate | utcDate }}</span
                ><span class="pl-3" *ngIf="invoiceCourse.endDate"
                  >To: {{ invoiceCourse.endDate | utcDate }}</span
                ><span class="pl-3" *ngIf="invoiceCourse.lessonCount"
                  >{{ invoiceCourse.lessonCount }} lessons</span
                >
              </div>
            </div> -->
            <div class="d-flex flex-column inv-courseFee">
              <div class="d-flex w-100">
                <div class="col-md-5 p-0 body-l text-c300">Course fee</div>
                <div class="col-md-1 p-0 text-right light-body-l text-c300">
                  1
                </div>
                <div class="col-md-2 p-0 text-right text-c300">
                  <p class="mb-0 light-body-l">
                    {{ invCurrency.sign }}
                    {{ invoice.courseFee.fee | financial }}
                  </p>
                </div>

                <div
                  class="col-md-2 p-0 text-right light-body-l text-c300"
                  *ngIf="invoice.courseFee.noTax == false"
                >
                  {{ invoice.courseFee.tax }} %
                </div>
                <div
                  class="col-md-2 p-0 text-right light-body-l text-c300"
                  *ngIf="invoice.courseFee.noTax == true"
                ></div>
                <div
                  class="col-md-2 p-0 text-right light-body-l text-c300"
                  *ngIf="invoice.courseFee.taxInclusive == true"
                >
                  {{ invCurrency.sign }} {{ invoice.courseFee.fee | financial }}
                </div>
                <div
                  class="col-md-2 p-0 text-right light-body-l text-c300"
                  *ngIf="invoice.courseFee.taxInclusive == false"
                >
                  {{ invCurrency.sign }}
                  {{ invoice.courseFee.amount | financial }}
                </div>
              </div>
              <div
                class="d-flex w-100"
                style="padding-top:5px"
                *ngIf="iscDiscount"
              >
                <div class="col-md-5 p-0 light-body-l discount-name">
                  Discount:
                  <span class="mb-0 text-b100">
                    {{ invCurrency.sign }} {{ cDiscount.value | financial }}
                  </span>
                </div>
                <div
                  class="col-md-1 p-0 text-right light-body-l discount-number"
                ></div>
                <div
                  class="col-md-2 p-0 text-right light-body-l discount-number"
                >
                  <p class="mb-0">
                    {{ invCurrency.sign }} {{ cDiscount.value | financial }}
                  </p>
                </div>
                <div
                  class="col-md-2 p-0 text-right light-body-l discount-number"
                >
                  {{ cDiscount.tax }} %
                </div>
                <div
                  class="col-md-2 p-0 text-right light-body-l discount-number"
                >
                  {{ invCurrency.sign }} {{ cDiscount.amount | financial }}
                </div>
              </div>
            </div>
            <div class="body-m text-c100">
              {{ invoiceCourse.name }}
              <div>
                <span *ngIf="invoiceCourse.startDate"
                  >From: {{ invoiceCourse.startDate | utcDate }}</span
                ><span class="pl-3" *ngIf="invoiceCourse.endDate"
                  >To: {{ invoiceCourse.endDate | utcDate }}</span
                ><span class="pl-3" *ngIf="invoiceCourse.lessonCount"
                  >{{ invoiceCourse.lessonCount }} lessons</span
                >
              </div>
            </div>
          </div>
        </div>

        <!-- <div class="inv-bordered">
        <div *ngIf="hideReg == false" class="d-flex inv-row">
          <div class="d-flex w-100 b-bottom mlr-15">
            <div class="col-md-5 p-0 light-body-l">
              Registration Fee
            </div>
            <div class="col-md-1 p-0 text-right light-body-l">1</div>
            <div class="col-md-2 p-0 text-right light-body-l">
              <p class="mb-0">{{ data.registrationFee.fee }}</p>
            </div>
            <div class="col-md-2 p-0 text-right light-body-l">
              {{ data.registrationFee.tax }}
              <span
                *ngIf="data.registrationFee.taxInclusive == true"
                class="tax-status"
                >(inclusive)</span
              >
              <span
                *ngIf="data.registrationFee.taxInclusive == false"
                class="tax-status"
                >(exclusive)</span
              >
            </div>
            <div class="col-md-2 p-0 text-right light-body-l">
              {{ invCurrency.sign }} {{ data.registrationFee.amount }}
            </div>
          </div>
        </div>
        <div *ngIf="hideMisc == false" class="d-flex inv-row">
          <div class="d-flex w-100 b-bottom mlr-15">
            <div class="col-md-5 p-0 light-body-l">
              Miscellaneous fee
            </div>
            <div class="col-md-1 p-0 text-right light-body-l">1</div>
            <div class="col-md-2 p-0 text-right light-body-l">
              <p class="mb-0">{{ data.miscFee.fee }}</p>
            </div>
            <div class="col-md-2 p-0 text-right light-body-l">
              {{ data.miscFee.tax }}
              <span
                *ngIf="data.miscFee.taxInclusive == true"
                class="tax-status"
                >(inclusive)</span
              >
              <span
                *ngIf="data.miscFee.taxInclusive == false"
                class="tax-status"
                >(exclusive)</span
              >
            </div>
            <div class="col-md-2 p-0 text-right light-body-l">
              {{ invCurrency.sign }} {{ data.miscFee.amount }}
            </div>
          </div>
        </div>
        <div *ngIf="hideDeposit == false" class="d-flex inv-row">
          <div class="d-flex w-100 b-bottom mlr-15">
            <div class="col-md-5 p-0 light-body-l">Deposit</div>
            <div class="col-md-1 p-0 text-right light-body-l">1</div>
            <div class="col-md-2 p-0 text-right light-body-l">
              <p class="mb-0">{{ data.deposit }}</p>
            </div>
            <div class="col-md-2 p-0 text-right light-body-l"></div>
            <div class="col-md-2 p-0 text-right light-body-l">
              {{ invCurrency.sign }} {{ data.deposit }}
            </div>
          </div>
        </div>
      </div> -->
        <!-- <hr class="invoice-hr" /> -->
        <div
          class="d-flex paid-item-box"
          *ngFor="let obj of newItemArr; let i = index"
        >
          <div class="d-flex flex-column w-100 item-row">
            <div class="d-flex flex-row new-item">
              <div class="col-md-5 light-body-l p-0">
                {{ obj.name }}
              </div>
              <div class="col-md-1 text-right light-body-l p-0">1</div>

              <div
                class="col-md-2 text-right light-body-l"
                style="
              padding-right: 0;
          "
              >
                <p class="mb-0 addPointer" (click)="showPopup1(i)">
                  {{ invCurrency.sign }} {{ obj.fee | financial }}
                </p>
              </div>
              <div class="col-md-2 text-right light-body-l p-0">
                <div *ngIf="obj.taxtype == ' No Tax'"></div>
                <div *ngIf="obj.taxtype != 'No Tax'">{{ obj.tax }}%</div>
              </div>
              <!-- <div class="col-md-2 text-right light-body-l p-0">
                <div>{{ obj.tax }}%</div>
              </div> -->
              <!-- <div class="col-md-2 text-right light-body-l">
                <input
                  class="form-control amount-txt"
                  placeholder="Amount"
                  type="number"
                  (input)="this.newItemArr[i].amount = $event.target.value"
                  [value]="obj.amount"
                />
              </div> -->
              <div class="col-md-2 text-right light-body-l p-0">
                {{ invCurrency.sign }} {{ obj.amount | financial }}
              </div>
            </div>
            <!-- new item discount exit  -->
            <div
              class="d-flex flex-row new-item"
              style="padding-top:5px"
              *ngIf="obj.isDiscount"
            >
              <div class="col-md-5 light-body-l p-0 discount-name">
                Discount
                <span class="mb-0 text-b100">
                  {{ invCurrency.sign }} {{ obj.discount.value | financial }}
                </span>
              </div>
              <div class="col-md-1 text-right light-body-l p-0"></div>
              <div
                class="col-md-2 text-right light-body-l discount-number"
                style="
                padding-right: 0;
            "
              >
                <!-- <div
                *ngIf="feesBox1 == true && activeFeeBoxId == i"
                class="popup-box price-box text-left"
              >
                <div id="rectangle"></div>
                <div class="p-3">
                  <h5>CourseFee</h5>
                  <div class="d-flex popup-input">
                    <div class="input-sign">
                      {{ invCurrency.sign }}
                    </div>
                    <input
                      class="w-100 input-txtaddCurseFee"
                      placeholder="Unit Price"
                      type="number"
                      min="0"
                      oninput="validity.valid||(value='')"
                      (input)="inputUnitPrice($event.target.value, i)"
                      (input)="unitPrice = $event.target.value"
                      [value]="obj.fee"
                    />
                  </div>
                </div>
              </div> -->

                <p class="mb-0">
                  {{ invCurrency.sign }} {{ obj.discount.value | financial }}
                </p>
              </div>
              <div class="col-md-2 text-right light-body-l p-0 discount-number">
                <div *ngIf="obj.discount.type != 'No Tax'">
                  {{ obj.discount.tax }}%
                </div>
                <div *ngIf="obj.discount.type == 'No Tax'"></div>
              </div>

              <!-- <div class="col-md-2 text-right light-body-l">
                  <input
                    class="form-control amount-txt"
                    placeholder="Amount"
                    type="number"
                    (input)="this.newItemArr[i].amount = $event.target.value"
                    [value]="obj.amount"
                  />
                </div> -->
              <div class="col-md-2 text-right light-body-l p-0 discount-number">
                {{ invCurrency.sign }} {{ obj.discount.amount | financial }}
              </div>
            </div>
          </div>
          <!-- <hr class="invoice-hr" /> -->
        </div>
        <div class="d-flex justify-content-end inv-all-amt">
          <div class="w-50">
            <div class="d-flex pad-10 light-body-l">
              <!-- <div class="col-md-8 p-0 text-center">Sub total</div> -->
              <div class="col-md-8 d-flex p-0">
                <div class="col-sm-7 text-right p-0">
                  Sub total
                </div>
                <div class="col-sm-5 p-0"></div>
              </div>
              <div class="col-md-4 text-right p-0">
                {{ invCurrency.sign }} {{ invoice.subtotal | financial }}
              </div>
            </div>
            <div class="d-flex pad-10 light-body-l">
              <div class="col-md-8 d-flex p-0">
                <div class="col-sm-7 text-right p-0">
                  Tax
                </div>
                <div class="col-sm-5 p-0 text-right"></div>
              </div>
              <div class="col-md-4 text-right p-0">
                {{ invCurrency.sign }} {{ invoice.tax.taxTotal | financial }}
              </div>
            </div>
            <div class="d-flex pad-10 light-body-l">
              <div class="col-md-8 d-flex p-0">
                <div class="col-sm-7 text-right p-0">
                  Total Discount
                </div>
                <div class="col-sm-5 p-0 text-right"></div>
              </div>
              <div class="col-md-4 text-right p-0">
                {{ invCurrency.sign }} {{ totalDiscount | financial }}
              </div>
            </div>
            <div class="d-flex pad-10 light-body-l">
              <div class="col-md-8 d-flex p-0">
                <div class="col-sm-7 text-right p-0">
                  Discount Tax
                </div>
                <div class="col-sm-5 p-0 text-right"></div>
              </div>
              <div class="col-md-4 text-right p-0">
                {{ invCurrency.sign }} {{ totalDiscounTax | financial }}
              </div>
            </div>
            <div class="d-flex body-l pad-10 mb-4 mt-3 bg-y50">
              <div class="col-md-8 d-flex p-0">
                <div class="col-sm-7 text-right p-0">
                  Amount due
                </div>
                <div class="col-sm-5 text-right p-0"></div>
              </div>
              <div class="col-md-4 text-right p-0">
                {{ invCurrency.sign }} {{ total | financial }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="invPayment?.length > 0" class="inv-margin">
        <div class="d-flex">
          <div class="col-md-4 p-0">
            <label class="body-l">Payment date</label>
          </div>
          <div class="col-md-4 p-0">
            <label class="body-l">Payment method</label>
          </div>
          <div class="col-md-4 p-0">
            <label class="body-l">Amount</label>
          </div>
        </div>
        <div *ngFor="let payment of invPayment">
          <!-- {{payment|json}} -->
          <div *ngIf="payment.status == 'COMPLETE'" class="d-flex pb-4">
            <div class="col-md-4 p-0">
              <p class="body-l">
                {{ payment.updatedDate | dateFormat }}
              </p>
            </div>
            <div class="col-md-4 p-0">
              <div class="d-flex">
                <!-- <img style="width: 100%;" src="../assets/img/mastercardlogo.jpg"> -->
                <!-- <div style="width: 55px;">

                <i class="fa fa-credit-card" style="font-size: 30px;"></i>
              </div> -->
                <div
                  class="pl-3"
                  *ngIf="payment.brandName || payment.cardNumber"
                >
                  <label class="mb-0 c-label body-l text-c100">{{
                    payment.brandName
                  }}</label>
                  <div class="d-flex light-body-l">
                    {{ payment.cardNumber }}
                  </div>
                </div>
                <div
                  class="c-label body-l text-c100"
                  *ngIf="payment.paymentMethod == 0"
                >
                  {{ paymentList[0]?.name }}
                </div>
                <div
                  class="c-label body-l text-c100"
                  *ngIf="payment.paymentMethod == 1"
                >
                  {{ paymentList[1]?.name }}
                </div>
                <div
                  class="c-label body-l text-c100"
                  *ngIf="payment.paymentMethod == 2"
                >
                  {{ paymentList[2]?.name }}
                </div>
                <div
                  class="c-label body-l text-c100"
                  *ngIf="payment.paymentMethod == 3"
                >
                  {{ paymentList[3]?.name }}
                </div>
              </div>
            </div>
            <div class="col-md-4 p-0 d-flex body-l">
              <span>{{ invCurrency.sign }} {{ payment.amount }}</span>
              <!-- <div>{{ payment.amount }}</div> -->
            </div>
          </div>
        </div>
      </div>
      <!-- <div class="invnote-readonly  body-m text-c100 pb-3">
        {{ invoiceInfo.invoiceNote }}
      </div> -->
    </div>

    <div class="modal-footer justify-content-between">
      <div class="d-flex">
        <div style="position: relative;">
          <div (click)="openActions()" class="action text-c300">
            Actions
            <img
              style="margin-left: 8px;"
              src="../../../assets/icons/drop-down.svg"
            />
          </div>
          <div *ngIf="actionFlag" class="action-dropdown">
            <div (click)="closeModal()" class="body-m text-c300 cursor">
              Close
            </div>
            <div
              (click)="invoiceDeleteModal(invoice_delete)"
              class="body-m text-r100 cursor"
            >
              Delete invoice
            </div>
          </div>
        </div>
        <div class="l-border">
          <button
            class="btn btn-print cursor-on"
            (click)="printInvoice()"
            [disabled]="isEditInv == true"
          >
            <img src="./assets/images/print@2x.png" />
          </button>
        </div>
      </div>
      <button
        class="btn btn-submit body-l bg-b100 text-s0"
        (click)="closeModal()"
      >
        Done
      </button>
    </div>
  </div>
  <div *ngIf="showPayment == true">
    <div
      *ngIf="invStatus == 'PAID[PARTIAL]'"
      class="paid-header h2-strong bg-g25 text-g200"
    >
      <!-- PAID[PARTIAL] -->
      Partially paid
      <img
        (click)="closeModal()"
        class="close-btn"
        src="assets/img/removeIcon.png"
      />
    </div>
    <div
      *ngIf="invStatus != 'PAID[PARTIAL]'"
      class="paid-header h2-strong bg-s20 text-g200"
    >
      <img
        (click)="closeModal()"
        class="close-btn"
        src="assets/img/removeIcon.png"
      />
    </div>
    <div class="inv-payment-container">
      <div class="logo-wrapper mb-3">
        <img src="{{ logo }}" />
      </div>
      <div class="mt-40">
        <label class="payment-label body-l text-c300"
          >Choose payment method</label
        >
        <div class="d-flex mt-1 mb-4">
          <div
            class="payment-item body-l text-c300"
            *ngFor="let provider of paymentProviders"
          >
            <label
              [ngClass]="{
                'selectedItem bg-b100 text-s0': selectedPayment == provider.name
              }"
              class="form-check-label"
            >
              <input
                class="form-check-input"
                type="radio"
                name="payment"
                id="payment1"
                value="provider.name"
                [(ngModel)]="paymentItem.type"
                #payment="ngModel"
                (click)="choosePayment(provider)"
              />
              {{ provider.name }}
            </label>
          </div>
        </div>
        <div>
          <form #paymentForm="ngForm" nonvalidate>
            <div class="mb-4">
              <label class="payment-label body-l text-c300"
                >Reference number</label
              >
              <div>
                <input
                  type="text"
                  name="ref"
                  class="w-75 cash-input body-l text-c300"
                  placeholder="Reference number"
                  [(ngModel)]="paymentItem.refNumber"
                  #refNumber="ngModel"
                />
              </div>
            </div>
            <div>
              <label class="payment-label body-l text-c300">Amount</label>
              <div class="d-flex align-items-center popup-input w-75">
                <div class="input-sign body-l text-c100">
                  {{ invCurrency.sign }}
                </div>
                <input
                  type="number"
                  name="amount"
                  class="w-100 cash-input body-l text-c300"
                  placeholder="0"
                  [(ngModel)]="paymentItem.amount"
                  #amount="ngModel"
                  (keypress)="isDecimalValue($event)"
                  required
                />
              </div>
              <div
                *ngIf="amount.invalid && (amount.dirty || amount.touched)"
                class="alert alert-danger alert-m-right w-75 mt-3"
              >
                <div [hidden]="!amount.errors.required">
                  Amount is required!
                </div>
                <!-- <div *ngIf="paymentItem.amount <= 0 && !amount.errors.required">
                Amount should be grater than 0;
              </div> -->
              </div>
            </div>
          </form>
        </div>
        <!-- <div *ngIf="selectedPayment != 'Cash'">
        <div class="mt-30">
          <label class="payment-label">Reference number</label>
          <div>
            <input
              type="text"
              name="ref"
              class="w-75 cash-input"
              placeholder="Reference number"
              [(ngModel)]="refInvID"
              readonly
            />
          </div>
        </div>
      </div> -->
      </div>
    </div>

    <div
      *ngIf="selectedPayment != ''"
      class="modal-footer justify-content-between fixed-bottom"
    >
      <button
        class="back-inv cursor-on bg-s0 body-l text-c300"
        (click)="backToInvoice()"
      >
        <i class="fa fa-angle-left body-xl"></i><span>Back</span>
      </button>
      <button
        class="btn btn-submit cursor-on body-l bg-b100 text-s0"
        (click)="payNow(selectedPayment)"
        [disabled]="paymentItem.amount == '' || paymentItem.amount == undefined"
      >
        PAY
      </button>
    </div>
  </div>
</div>
<ng-template #invoice_delete>
  <div class="invoice-delete-modal">
    <h3 class="modal-title enroll_title h3-strong text-c300">
      Confirm delete?
    </h3>
    <div class="autoEnroll-body">
      <p class="light-body-l text-c100">
        Are you sure you want to delete? You wont back it return.
      </p>
    </div>
    <div
      class="autoEnroll-footer d-flex justify-content-end align-items-center pr-3"
    >
      <button
        type="button"
        class="btn modal-cancel-btn body-l bg-s0 text-c300 mr-2"
        (click)="cancelInvoiceDelete()"
      >
        Cancel
      </button>
      <button
        type="submit"
        class="btn modal-delete-btn bg-r100 text-s0 body-l"
        (click)="deleteInvoice()"
      >
        Delete
      </button>
    </div>
  </div>
</ng-template>
