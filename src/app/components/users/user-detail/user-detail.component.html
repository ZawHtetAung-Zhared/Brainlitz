<app-header [ngClass]="{ stick: isSticky == true }"></app-header>

<div class="d-flex flex-column justify-content-center align-items-center">
  <div
    *ngIf="!detailLoading"
    class="content-wrapper w-100"
    [ngClass]="{ pdactive: isSticky == true }"
  >
    <div class="main-wrapper">
      <div class="top-profile-wrap">
        <div class="d-flex heading-space">
          <div class="back text-c300 body-l" (click)="backToCustomer()">
            <i class="fa fa-angle-left body-xl text-c200"></i
            ><span>Customers</span>
          </div>
          <div class="ml-auto d-flex align-items-center">
            <div
              class="d-flex auto-enroll align-items-center justify-content-between"
              [ngClass]="{ autoEnrollTrue: userArchive }"
            >
              <label
                class="switch-label mt-0 body-l text-c100"
                for="online"
                *ngIf="userArchive"
                >Archive</label
              >
              <label
                class="switch-label mt-0 body-l text-c100"
                for="online"
                *ngIf="!userArchive"
                >Unarchive</label
              >
              <div class="toggle-wrap d-flex align-items-center">
                <label class="switch" *ngIf="userArchive">
                  <input type="button" (click)="staffArchive(false)" />
                  <span
                    class="slider round"
                    [ngClass]="{
                      'checked-slider': true
                    }"
                  ></span>
                </label>
                <label *ngIf="!userArchive" class="switch">
                  <input type="button" (click)="staffArchive(true)" />
                  <span class="slider round"></span>
                </label>
              </div>
            </div>
            <span
              *ngIf="customerDemo.editCustomer != ''"
              class="back text-c300 body-l"
              (click)="getSingleInfo(editId)"
              >Edit profile</span
            >
          </div>
        </div>

        <div class="d-flex align-items-center justify-content-between">
          <div class="half-profile-wrap">
            <div class="circular-image big-circular-image">
              <img src="{{ custDetail.user.profilePic }}" />
            </div>
            <div
              class="user-grading"
              *ngIf="(custDetail.user.userGrading?.grade | json) != '{}'"
            >
              <div
                *ngIf="
                  custDetail.user.userGrading?.grade.point != undefined &&
                  custDetail.user.userGrading?.grade.point != null
                "
                class="b-white justify-content-center d-flex caption"
                [style.background]="
                  custDetail.user.userGrading.sepalColor.background
                "
                [ngClass]="{
                  'big-test-circle':
                    custDetail.user.userGrading.grade.point.length == 1,
                  circle: custDetail.user.userGrading.grade.point.length > 1
                }"
              >
                <span
                  [style.color]="custDetail.user.userGrading.sepalColor.text"
                >
                  {{ custDetail.user.userGrading.grade.point }}
                </span>
              </div>
            </div>
          </div>
          <div
            *ngIf="custDetail.user.guardians?.length > 0"
            class="infoGp-wrap"
          >
            <label class="word-break text-c100 body-m">Guardians</label>
            <div class="guardian-main-wrap d-flex">
              <div
                *ngFor="let guardian of custDetail.user.guardians"
                class="g-inner-wrap d-flex"
              >
                <div class="small-circular-image">
                  <img
                    *ngIf="
                      guardian.profilePic == undefined ||
                      guardian.profilePic == ''
                    "
                    src="assets/img/user.svg"
                  />
                  <img
                    *ngIf="guardian.profilePic != undefined"
                    src="{{ guardian.profilePic }}"
                  />
                </div>

                <div
                  class="cursor-on light-body-l text-b100"
                  (click)="showGuardian(guardian.userId)"
                >
                  {{
                    guardian.fullName == '' || guardian.fullName == null
                      ? guardian.email
                      : guardian.fullName
                  }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="btn-wrap"></div>
      <div class="">
        <div class="row section-wrap">
          <div
            class="d-flex flex-column profile-left col-md-4 col-xl-3 col-lg-3"
          >
            <div class="infoGp-wrap">
              <h5 class="h1-strong">{{ custDetail.user.preferredName }}</h5>
              <p class="word-break light-body-l text-c100 mb-0">
                {{ custDetail.user.email }}
              </p>
            </div>
            <div
              class="infoGp-wrap mb-0"
              style="border-bottom: 1px dotted #7A8A99;"
            >
              <p
                *ngIf="custDetail.user.about"
                class="mb-0 light-body-m text-c100"
              >
                {{ custDetail.user.about }}
              </p>
              <p
                *ngIf="!custDetail.user.about"
                class="mb-0 light-body-m text-c100"
                style="margin-top: -20px"
              >
                -
              </p>
            </div>
            <div>
              <div class="infoGp-wrap" *ngIf="custDetail.user.fullName != ''">
                <label class="word-break text-c100 body-m">Full name</label>
                <p class="mb-0 info-p body-xl">
                  {{ custDetail.user.fullName }}
                </p>
              </div>
              <div class="infoGp-wrap" *ngIf="custDetail.user.fullName == ''">
                <label class="word-break text-c100 body-m">Full name</label>
                <p class="mb-0 info-p body-xl">
                  -
                </p>
              </div>
              <div class="left-scroll-wrap">
                <div
                  *ngFor="let detail of custDetail.user.details"
                  class="infoGp-wrap"
                >
                  <label
                    class="word-break text-c100 body-m"
                    *ngIf="detail.value.length != 0"
                    >{{ detail.name }}</label
                  >
                  <div *ngIf="detail.dataType == 'Date'">
                    <span
                      class="mb-0 info-p body-xl"
                      *ngIf="detail.value.length != 0"
                    >
                      {{ detail.value | todayDate2 }}
                    </span>
                    <span
                      class="word-break text-c100 body-m"
                      *ngIf="detail.value.length != 0"
                    >
                      ({{
                        detail.year > 1
                          ? detail.year + ' years, '
                          : detail.year > 0
                          ? detail.year + ' year, '
                          : ''
                      }}{{
                        detail.day > 1
                          ? detail.day + ' days'
                          : detail.day + ' day'
                      }})
                    </span>
                  </div>
                  <div *ngIf="detail.dataType != 'Date'">
                    <p
                      class="mb-0 info-p body-xl"
                      *ngIf="detail.value.length != 0"
                    >
                      {{ detail.value }}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div
            class="col-md-8 col-xl-9 col-lg-9 d-flex flex-column profile-right"
          >
            <div class="d-flex tab-section bg-s0">
              <button
                [ngClass]="{ 'active text-b100': activeTab == 'class' }"
                class="btn tab-btn body-l"
                (click)="clickTab('class')"
              >
                Course
              </button>
              <button
                [ngClass]="{ 'active text-b100': activeTab == 'makeup' }"
                class="btn tab-btn body-l"
                (click)="clickTab('makeup')"
              >
                Makeup pass
              </button>
              <button
                [ngClass]="{ 'active text-b100': activeTab == 'subscription' }"
                class="btn tab-btn body-l"
                (click)="clickTab('subscription')"
              >
                Subscription
              </button>
              <button
                [ngClass]="{ 'active text-b100': activeTab == 'achievements' }"
                class="btn tab-btn body-l"
                (click)="clickTab('achievements')"
              >
                Achievements
              </button>
              <button
                [ngClass]="{ 'active text-b100': activeTab == 'notifications' }"
                class="btn tab-btn body-l"
                (click)="clickTab('notifications')"
              >
                Notifications
              </button>
              <button
                [ngClass]="{ 'active text-b100': activeTab == 'activity' }"
                class="btn tab-btn body-l"
                (click)="clickTab('activity')"
              >
                Activity
              </button>
            </div>
            <div *ngIf="activeTab == 'class' && !tabLoading" class="pb-20">
              <div class="d-flex title-space">
                <div class="d-flex flex-column justify-content-center">
                  <h4 class="mb-0 body-xl text-c300">Attending lessons</h4>
                </div>
                <button
                  *ngIf="customerDemo.enrollStudent != ''"
                  (click)="
                    callEnrollModal(
                      classEnrollModal,
                      custDetail.user.userId,
                      'enroll'
                    )
                  "
                  class="ml-auto enroll-btn body-m text-s0 bg-b100"
                >
                  Enroll new class
                </button>
              </div>

              <div class="col-md-12 col-lg-12 col-xl-9 pl-0 pr-0">
                <div
                  class="no-item body-m text-c100"
                  *ngIf="custDetail.courses?.length <= 0"
                >
                  There is no course from this customer!
                </div>
                <div
                  class="child_two bg-s0"
                  *ngFor="
                    let course of custDetail.courses
                      | slice
                        : 0
                        : [
                            selectedId.indexOf('course') != -1
                              ? custDetail.courses.length
                              : 2
                          ];
                    let i = index
                  "
                >
                  <div class="section-one">
                    <div class="row d-flex">
                      <div class="col-7">
                        <div
                          class="d-flex justify-content-between"
                          style="padding-left: 20px"
                        >
                          <label
                            class="class-label-12 caption"
                            [ngStyle]="{
                              color: course.location?.textColorHex,
                              background: course.location?.backgroundColorHex
                            }"
                            ><i
                              class="fa fa-map-marker"
                              style="font-size:12px;padding-right: 4px"
                            ></i
                            >{{
                              course.location == null
                                ? '-'
                                : course.location?.name
                            }}</label
                          >
                        </div>
                        <p
                          class="info-p body-xl clickable text-b100 pt-2"
                          (click)="onClickCourse(course)"
                          style="padding-left: 20px"
                        >
                          {{ course.name }}
                        </p>
                        <div class="d-flex">
                          <div class="d-flex info-wrap justify-content-between">
                            <div class="d-flex">
                              <div
                                *ngIf="course.startDate"
                                class="timetable-col"
                                style="padding-left: 20px"
                              >
                                <label class="word-break body-m text-c100 mb-0"
                                  >From</label
                                >
                                <p class="body-l text-c100 mb-0">
                                  {{ course.startDate | utcDate }}
                                </p>
                              </div>
                              <div class="timetable-col">
                                <label
                                  *ngIf="course.endDate"
                                  class="word-break body-m text-c100 mb-0"
                                  >To</label
                                >
                                <label
                                  *ngIf="course.lessonCount"
                                  class="word-break body-m text-c100 mb-0"
                                ></label>
                                <p
                                  *ngIf="course.endDate"
                                  class="body-l text-c100 mb-0"
                                >
                                  {{ course.endDate | utcDate }}
                                </p>
                              </div>
                            </div>
                            <div class="d-flex tchr-img align-items-center">
                              <div class="tchr-img-wraper">
                                <img
                                  src="{{ course.teacher?.profilePic }}"
                                  alt=""
                                  class="teacher-pic"
                                />
                              </div>
                              <div class="teacher">
                                <label class="word-break body-m text-c100 mb-0"
                                  >Teacher</label
                                >
                                <p class="body-l text-c100 mb-0">
                                  {{ course.teacher?.preferredName }}
                                </p>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="d-flex info-wrap justify-content-between">
                          <div>
                            <label
                              class="body-l text-c100 mb-0"
                              style="padding-left: 20px"
                              *ngFor="let day of course.repeatDays | weekDays"
                              >{{ course.type == 'ONLINE' ? '' : day }}</label
                            >
                            <p
                              style="padding-left: 20px"
                              *ngIf="course.duration != undefined"
                              class="word-break body-m text-c100 mb-0"
                            >
                              {{
                                course.type == 'ONLINE'
                                  ? ''
                                  : (course.duration.startDate | utcTime)
                              }}
                              {{ course.type == 'ONLINE' ? '' : '-' }}
                              {{
                                course.type == 'ONLINE'
                                  ? ''
                                  : (course.duration.endDate | utcTime)
                              }}
                            </p>
                          </div>
                          <div class="remaining">
                            <div
                              class="body-l text-b100 remaining-lessons"
                              (click)="
                                openLessonsModal(remainingLessons, course)
                              "
                            >
                              {{ course.upComingLessonCountOfStudent }}
                              <span
                                *ngIf="course.upComingLessonCountOfStudent > 1"
                              >
                                remaining lessons
                              </span>
                              <span
                                *ngIf="course.upComingLessonCountOfStudent <= 1"
                              >
                                remaining lesson
                              </span>
                            </div>
                          </div>
                        </div>
                        <div class="line mt-3"></div>
                        <div style="position: relative;">
                          <div
                            class="d-flex auto-enroll align-items-center"
                            [ngClass]="{ autoEnrollTrue: course.autoEnroll }"
                            style="margin-left: 20px;float:left;width:50%;"
                            *ngIf="course.type == 'FLEXY'"
                          >
                            <label
                              class="switch-label mt-0 body-l text-c100"
                              for="online"
                              >Auto enroll for next term</label
                            >
                            <div
                              class="toggle-wrap toggle-ipad d-flex align-items-center"
                            >
                              <label
                                class="switch"
                                *ngIf="
                                  course.autoEnroll != undefined &&
                                  course.autoEnroll
                                "
                              >
                                <input
                                  type="button"
                                  (click)="autoEnroll(i, course, auto_Enroll)"
                                />
                                <span
                                  class="slider round"
                                  [ngClass]="{
                                    'checked-slider':
                                      course.autoEnroll != undefined &&
                                      course.autoEnroll
                                  }"
                                ></span>
                              </label>
                              <label
                                class="switch"
                                *ngIf="
                                  course.autoEnroll == undefined ||
                                  !course.autoEnroll
                                "
                              >
                                <input
                                  type="button"
                                  (click)="autoEnroll(i, course, auto_Enroll)"
                                />
                                <span class="slider round"></span>
                              </label>
                            </div>
                          </div>
                          <!-- <div
                          class="d-flex align-items-center"
                        >
                          <img src="./assets/icons/journal.svg" />
                          <label
                            class="btn body-l text-c300 mb-0"
                            (click)="
                              viewJournal(
                                journalContent,
                                course,
                                course.teacher.preferredName
                              )
                            "
                          >
                            View journal
                          </label>
                        </div> -->
                          <div
                            (click)="moreOpt[i] = !moreOpt[i]"
                            class="more-option d-flex justify-content-center align-items-center"
                          >
                            <span class="body-m text-b100">More</span>
                            <div *ngIf="moreOpt[i]" class="more-popup">
                              <div
                                (click)="
                                  viewJournal(
                                    journalContent,
                                    course,
                                    course.teacher.preferredName
                                  )
                                "
                                class="body-m text-s0 cursor-on"
                                style="padding-bottom: 16px;border-bottom: 1px solid #5C6773;"
                              >
                                View journal
                              </div>
                              <div
                                (click)="
                                  callTransferModal(
                                    classTransferModal,
                                    custDetail.user.userId,
                                    course
                                  )
                                "
                                class="body-m text-s0 cursor-on"
                                style="padding-top: 16px;"
                              >
                                Transfer class
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div
                        class="show-invoice bg-s20 col-5"
                        [ngClass]="{
                          'd-flex justify-content-center align-items-center':
                            course.invoicesOfCourse &&
                            course.invoicesOfCourse.length < 1
                        }"
                      >
                        <div
                          class="d-flex flex-column"
                          class="noInvoicetxt"
                          *ngIf="
                            course.invoicesOfCourse &&
                            course.invoicesOfCourse.length < 1
                          "
                        >
                          <h3 class="h3-strong text-c300">Invoice</h3>
                          <p class="light-body-m text-c100">
                            There is no invoice generated for this course yet.
                          </p>
                        </div>
                        <div class="scrollbar">
                          <div
                            class="d-flex invoice-change align-items-center"
                            *ngIf="
                              course.invoicesOfCourse &&
                              course.invoicesOfCourse.length > 0
                            "
                          >
                            <label class="invoice-label h3-strong text-c300"
                              >Invoice</label
                            >
                            <span
                              class="invoiceOflength bg-s0 caption"
                              *ngIf="course.invoicesOfCourse != undefined"
                              >{{ course.invoicesOfCourse.length }}</span
                            >
                          </div>
                          <div
                            class=" invoice-list"
                            *ngFor="let invoice of course.invoicesOfCourse"
                          >
                            <div class="d-flex">
                              <div class="first-one d-flex flex-column">
                                <p class="lesson small text-b300">
                                  {{ invoice.studentLessonsCount }}
                                  <span *ngIf="invoice.studentLessonsCount > 1">
                                    lessons
                                  </span>
                                  <span
                                    *ngIf="invoice.studentLessonsCount <= 1"
                                  >
                                    lesson
                                  </span>
                                </p>
                                <span
                                  class="date body-m text-c300"
                                  *ngIf="
                                    invoice.courseDuration != undefined &&
                                    invoice.courseDuration.startDate !=
                                      undefined &&
                                    invoice.courseDuration.endDate != undefined
                                  "
                                >
                                  {{
                                    invoice.courseDuration.startDate | utcDate
                                  }}
                                  -
                                  {{ invoice.courseDuration.endDate | utcDate }}
                                </span>
                                <label class="payment body-m text-c100"
                                  >Payment date</label
                                >
                                <p class="date1 body-m text-c300">
                                  {{ invoice.updatedDate | utcDate }}
                                </p>
                              </div>
                              <div
                                class="second-one"
                                style="padding-left: 10px"
                              >
                                <div
                                  class="d-flex"
                                  style="margin-top: 14px;margin-bottom: 12px"
                                >
                                  <div
                                    class="paybill"
                                    [ngClass]="{
                                      'paid-status bg-g25 text-g200':
                                        invoice.status == 'PAID',
                                      'unpaid-status bg-r25 text-r200':
                                        invoice.status == 'UNPAID',
                                      'partially-paid-status bg-y25 text-y300 partially-paid-width':
                                        invoice.status == 'PAID[PARTIAL]'
                                    }"
                                  >
                                    <p class="caption pl-2">
                                      {{
                                        invoice.status == 'PAID[PARTIAL]'
                                          ? 'Partially paid'
                                          : invoice.status == 'PAID'
                                          ? 'Paid'
                                          : 'Unpaid'
                                      }}
                                    </p>
                                  </div>
                                  <span class="right"></span>
                                </div>
                                <div
                                  class="date body-m text-c300"
                                  *ngIf="course.invoice != null; currency"
                                >
                                  <span
                                    class="currency date body-m text-c300"
                                    >{{ invoice.currency.sign }}</span
                                  >
                                  {{ invoice.total }}
                                </div>
                                <span
                                  class="view-invoice body-m bg-s0 text-b100"
                                  (click)="
                                    viewFlexyInvoice(
                                      classEnrollModal,
                                      course,
                                      invoice
                                    )
                                  "
                                >
                                  View invoice
                                </span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div>
                <div *ngIf="custDetail.courses?.length > 2">
                  <button
                    *ngIf="selectedId.indexOf('course') == -1"
                    class="body-m text-b100 btn-showmore p-0"
                    (click)="showMoreItem('course')"
                  >
                    <span>Show more</span
                    ><i class="fa fa-angle-down body-l" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
            </div>

            <div *ngIf="activeTab == 'makeup' && !tabLoading" class="pb-20">
              <div class="d-flex justify-content-center">
                <ul class="pass-list body-m">
                  <li
                    [ngClass]="{ 'bg-b100 text-s0': activePass == 'available' }"
                    (click)="clickPass('available')"
                  >
                    Available
                  </li>
                  <li
                    [ngClass]="{ 'bg-b100 text-s0': activePass == 'claimed' }"
                    (click)="clickPass('claimed')"
                  >
                    Claimed
                  </li>
                  <li
                    [ngClass]="{ 'bg-b100 text-s0': activePass == 'expired' }"
                    (click)="clickPass('expired')"
                  >
                    Expired
                  </li>
                </ul>
              </div>
              <div
                *ngIf="makeupLists && !makeupLoading"
                class="row makeup-wrap"
              >
                <div class="col-md-6 col-lg-4" *ngFor="let list of makeupLists">
                  <div class="single-makeup bg-s0">
                    <div
                      *ngIf="activePass == 'available'"
                      class="d-flex justify-content-between align-items-center makeup-head"
                    >
                      <p class="small">
                        Valid until
                        <span class="valid-date caption"
                          >{{ list.expirationDate.day }}
                          {{ list.expirationDate.month - 1 | TTmonth }}
                          {{ list.expirationDate.year }}</span
                        >
                      </p>
                      <button
                        class="btn btn-pencil"
                        placement="left"
                        ngbTooltip="Edit valid date"
                        (click)="oneditMakeup(editMakeup, list)"
                      ></button>
                    </div>
                    <div
                      *ngIf="activePass == 'claimed' || activePass == 'expired'"
                      style="width: 100%;"
                      class="d-flex justify-content-end"
                    >
                      <button
                        class="btn btn-pencil"
                        placement="left"
                        ngbTooltip="Edit valid date"
                        (click)="oneditMakeup(editMakeup, list)"
                      ></button>
                    </div>
                    <div class="makeup-body">
                      <h5 class="makeup-title body-l text-c300">
                        {{ list.name }}
                      </h5>
                      <p class="makeup-desc body-m text-c100 mb-0">
                        {{ list.reason }}
                      </p>
                      <div class="makeup-box small bg-s20">
                        <p class="caption text-c100">
                          Issued on {{ list.issueDate.day }}
                          {{ list.issueDate.month - 1 | TTmonth }}
                          {{ list.issueDate.year }}
                        </p>
                        <div class="issue-box bg-s0 d-flex flex-column">
                          <strong class="text-c300 caption">{{
                            list.course.name
                          }}</strong>
                          <label
                            *ngIf="list.course.type !== 'ONLINE'"
                            class="text-c100 mb-0"
                          >
                            <span
                              >{{ list.course.startTime.hr | timeFormat }} :
                              {{ list.course.startTime.min | timeFormat }}
                              {{ list.course.startTime.meridiem }}</span
                            >
                            -
                            <span
                              >{{ list.course.endTime.hr | timeFormat }} :
                              {{ list.course.endTime.min | timeFormat }}
                              {{ list.course.endTime.meridiem }}</span
                            ></label
                          >

                          <div *ngIf="list.cancelledLesson" class="text-c100">
                            <span
                              *ngIf="
                                list.cancelledLesson.startDate != undefined
                              "
                            >
                              <span
                                >{{
                                  list.cancelledLesson.startDate | timelineDate
                                }}
                              </span>
                              <span
                                >{{
                                  list.cancelledLesson.startDate | yearFormat
                                }}
                              </span>
                            </span>

                            <strong
                              class="text-c300 caption"
                              *ngIf="
                                list.cancelledLesson.startDate == undefined
                              "
                            >
                              <span *ngIf="list.course.type !== 'ONLINE'"
                                >-</span
                              >
                            </strong>
                          </div>
                          <strong
                            class="text-c300 caption"
                            *ngIf="!list.cancelledLesson"
                            ><span *ngIf="list.course.type !== 'ONLINE'"
                              >-</span
                            >
                          </strong>
                        </div>
                        <div *ngIf="activePass == 'claimed'">
                          <p class="caption text-c100">
                            Claimed on {{ list.filingDate.day }}
                            {{ list.filingDate.month - 1 | TTmonth }}
                            {{ list.filingDate.year }}
                          </p>
                          <div
                            class="claimed-box bg-s0 d-flex flex-column"
                            *ngIf="list.makeupCourse"
                          >
                            <strong class="text-c300 caption">{{
                              list.makeupCourse.name
                            }}</strong>
                            <label
                              class="text-c100 mb-0"
                              *ngIf="
                                list.course.type !== 'ONLINE' &&
                                list.makeupCourse.startTime
                              "
                            >
                              <span
                                >{{
                                  list.makeupCourse.startTime.hr | timeFormat
                                }}
                                :
                                {{
                                  list.makeupCourse.startTime.min | timeFormat
                                }}
                                {{ list.makeupCourse.startTime.meridiem }}</span
                              >
                              -
                              <span>
                                {{ list.makeupCourse.endTime.hr | timeFormat }}
                                :
                                {{ list.makeupCourse.endTime.min | timeFormat }}
                                {{ list.makeupCourse.endTime.meridiem }}
                              </span>
                            </label>

                            <div *ngIf="list.claimedDateFor">
                              <strong
                                class="text-c300 caption"
                                *ngIf="list.claimedDateFor.day != null"
                              >
                                {{ list.claimedDateFor.day }}
                                {{ list.claimedDateFor.month - 1 | TTmonth }}
                                {{ list.claimedDateFor.year }}
                              </strong>
                              <strong
                                class="text-c300 caption"
                                *ngIf="list.claimedDateFor.day == null"
                              >
                                <span *ngIf="list.course.type !== 'ONLINE'"
                                  >-</span
                                >
                              </strong>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="left-scoope"></div>
                    <div class="right-scoope"></div>
                    <div
                      *ngIf="activePass == 'available'"
                      class="makeup-footer d-flex justify-content-center"
                    >
                      <p
                        (click)="openClaimModal(claimModal, list)"
                        class="body-m text-b100 bg-s0 claim-text"
                      >
                        Claim this pass
                      </p>
                    </div>
                    <div
                      *ngIf="activePass == 'claimed'"
                      class="makeup-footer d-flex justify-content-center"
                    >
                      <img
                        src="./assets/img/badge-tick.png"
                        class="claim-img"
                      />
                      <p class="body-m mb-0 text-g100">Claimed pass</p>
                    </div>
                    <div
                      *ngIf="activePass == 'expired'"
                      class="makeup-footer d-flex justify-content-center"
                    >
                      <img
                        src="./assets/img/badge-minus.png"
                        class="claim-img"
                      />
                      <p class="body-m mb-0 text-c100">Expired</p>
                    </div>
                  </div>
                </div>
              </div>
              <div *ngIf="makeupLoading" class="w-100 mt-4">
                <content-loader>
                  <svg:rect
                    x="0"
                    y="0"
                    rx="3"
                    ry="3"
                    width="30%"
                    height="500"
                  />
                  <svg:rect
                    x="35%"
                    y="0"
                    rx="3"
                    ry="3"
                    width="30%"
                    height="500"
                  />
                </content-loader>
              </div>
            </div>
            <div *ngIf="activeTab == 'subscription' && !tabLoading">
              <app-subscription [custDetail]="custDetail"></app-subscription>
            </div>
            <div
              *ngIf="activeTab == 'achievements' && !tabLoading"
              class="pb-20"
              style="overflow:hidden"
            >
              <div
                class="title-space no-item body-m text-c100"
                *ngIf="
                  achievementProgess.length <= 0 &&
                  achievementEvaluation.length <= 0 &&
                  achievementGrade.length <= 0
                "
              >
                There is no achievements for this customer!
              </div>
              <div
                class="achievements-main"
                *ngIf="achievementProgess.length != 0"
              >
                <div class="achievements-header bg-s20">
                  <h6 class="p-0 body-l text-c300">Progress</h6>
                </div>

                <div class="row progress-list">
                  <div
                    class="col-xs-12 col-sm-12 col-md-12 col-lg-6 col-xl-4"
                    *ngFor="let progress of achievementProgess"
                  >
                    <div class="progress-box libr">
                      <p class="course-name body-l text-c300">
                        {{ progress.course.name }}
                      </p>

                      <span class="light-body-m text-c100"
                        >{{ progress.score }}% accomplished</span
                      >
                      <div class="bar-wrapper achievements-progress">
                        <ngb-progressbar
                          [value]="progress.score"
                          height="0.3rem"
                        ></ngb-progressbar>
                      </div>
                      <div class="progress-footer body-m text-c100">
                        <span class="update-date"
                          >Update on {{ progress.createdDate | utcDate }}</span
                        >
                        <span class="by-name"
                          >by {{ progress.by.preferredName }}</span
                        >
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="achievements-main"
                *ngIf="achievementGrade.length != 0"
              >
                <div class="achievements-header bg-s20">
                  <h6 class="p-0 body-l text-c300">Grade</h6>
                </div>
                <div class="card-columns grade-list">
                  <div *ngFor="let grade of achievementGrade">
                    <div class="card">
                      <div class="grade-main">
                        <div class="grade-header">
                          <p class="grade-txt small text-c100">
                            Grade level for
                          </p>
                          <p class="grade-apg-name body-l text-c300">
                            {{ grade.assessment.apgName }}
                          </p>
                          <div
                            class="pick-grade-wrap bg-s0 light-body-m text-c100 d-flex align-items-center"
                          >
                            <div class="pick-grade-text">
                              <span>Pick a grade level</span>
                            </div>
                            <div
                              class="pick-grade-image d-flex align-items-center justify-content-center"
                            >
                              <img
                                src="./assets/icons/pencil.svg"
                                (click)="
                                  pickGrade(pickGradeModal, grade, $event)
                                "
                              />
                            </div>
                          </div>
                        </div>
                        <div class="d-flex grade-body">
                          <span
                            class="evaluation-status caption text-s50"
                            *ngIf="grade.assessment.logs.length <= 0"
                            >No Data</span
                          >
                          <div
                            *ngIf="grade.assessment.logs.length != 0"
                            class="d-flex"
                          >
                            <div
                              *ngFor="
                                let log of grade.assessment.logs;
                                let i = index
                              "
                            >
                              <div
                                class="d-flex flex-column grade-box body-l"
                                [ngStyle]="{
                                  background:
                                    grade.assessment.sepalColor.background,
                                  color: grade.assessment.sepalColor.text
                                }"
                                [ngClass]="{
                                  addBorder:
                                    i == grade.assessment.logs.length - 1
                                }"
                              >
                                <span class="h4-strong">{{
                                  log.grade.name
                                }}</span>
                                <span class="body-m">by {{ log.by }}</span>
                                <div
                                  class="d-flex justify-content-between align-items-center"
                                >
                                  <span class="light-body-m">
                                    {{ log.createdDate | dateFormat }}</span
                                  >
                                  <span
                                    class="journal_delete grade_delete body-m text-r100 grade-bin"
                                    (click)="
                                      gradeDeleteModal(
                                        log.gradeId,
                                        journal_delete
                                      )
                                    "
                                  ></span>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="achievements-main"
                *ngIf="achievementEvaluation.length != 0"
              >
                <div class="achievements-header bg-s20">
                  <h6 class="p-0 body-l text-c300">Evaluation</h6>
                </div>

                <div class="card-columns evaluation-list">
                  <div *ngFor="let evaluation of achievementEvaluation">
                    <div class="card">
                      <div class="evaluation-main">
                        <div class="evaluation-header">
                          <p class="body-l text-c300 mb-0">
                            {{ evaluation.apg.name }}
                          </p>
                        </div>
                        <div class="evaluation-body">
                          {{ evaluation.assessments.isLoadmore }}
                          <carousel>
                            <ng-container
                              *ngFor="let ass of evaluation.assessments"
                            >
                              <ng-container *carouselItem>
                                <div
                                  class="createdDate caption text-b100"
                                  *ngIf="ass.createdDate != null"
                                >
                                  {{ ass.createdDate | utcDate }}
                                </div>

                                <div
                                  class="createdDate-boder"
                                  *ngIf="ass.createdDate == null"
                                ></div>

                                <div class="assessment-list-gp">
                                  <div
                                    class="assessment-list"
                                    *ngFor="let evaluate of ass.evaluations"
                                  >
                                    <div class="d-flex">
                                      <p
                                        class="assessment-name body-m text-c300"
                                      >
                                        {{ evaluate.apName }}
                                      </p>
                                    </div>

                                    <span
                                      class="evaluation-status caption text-s50"
                                      *ngIf="evaluate.status == 'NEUTRAL'"
                                      >No Data</span
                                    >
                                    <span
                                      class="evaluation-status caption text-y100"
                                      *ngIf="evaluate.status == 'IN-PROGRESS'"
                                      >In Progess</span
                                    >
                                    <span
                                      class="evaluation-status caption text-g100"
                                      *ngIf="evaluate.status == 'PASS'"
                                      >Achieved</span
                                    >
                                    <div
                                      class="d-flex flex-wrap evaluate-details"
                                    >
                                      <span
                                        class="list-dot-wrap"
                                        *ngFor="
                                          let detail of evaluate.details;
                                          let i = index
                                        "
                                      >
                                        <span
                                          class="noData-dot bg-s50"
                                          *ngIf="detail.selectedIndex == 'null'"
                                        ></span>
                                        <span
                                          class="exitData-dot bg-r100 text-s0"
                                          *ngIf="detail.selectedIndex == '0'"
                                          >{{ detail.selectedIndex }}</span
                                        >
                                        <span
                                          class="exitData-dot bg-y100 text-s0"
                                          *ngIf="detail.selectedIndex == '1'"
                                          >{{ detail.selectedIndex }}</span
                                        >
                                        <span
                                          class="exitData-dot bg-g100 text-s0"
                                          *ngIf="detail.selectedIndex == '2'"
                                          >{{ detail.selectedIndex }}</span
                                        >
                                      </span>
                                    </div>
                                  </div>
                                </div>
                              </ng-container>
                            </ng-container>
                          </carousel>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div
              *ngIf="activeTab == 'notifications' && !tabLoading"
              class="right-scroll-wrap"
            >
              <div class="d-flex flex-column pb-20">
                <h4 class="mb-0 body-xl text-c300 title-space">
                  Notifications
                </h4>
                <div
                  *ngFor="let notification of notifications; let i = index"
                  class="d-flex flex-column"
                >
                  <div class="title-space noti-date caption">
                    {{ notification.date.utcDate | todayDate2 }}
                  </div>
                  <div
                    *ngFor="let noti of notification.noti; let j = index"
                    class="d-flex flex-column"
                  >
                    <div class="d-flex justify-content-between title-space">
                      <div class="d-flex align-items-center">
                        <div>
                          <div id="parent">
                            <img
                              *ngIf="
                                noti.type == 1 ||
                                noti.type == 2 ||
                                noti.type == 3
                              "
                              [ngClass]="{
                                'img-read': noti.isRead == true,
                                'img-unread': noti.isRead == false
                              }"
                              style="filter: brightness(50%);"
                              src="./assets/images/courseIconFrame.png"
                            />
                          </div>
                        </div>
                        <div class="col-md-12" style="padding-left: 0px;">
                          <div
                            class="status-p"
                            [ngClass]="{
                              'status-read light-body-l text-c100':
                                noti.isRead == true,
                              'status-unread h4-strong text-c300':
                                noti.isRead == false
                            }"
                          >
                            {{ noti.title }}
                          </div>
                        </div>
                      </div>
                      <div class="d-flex align-items-center">
                        <div class="status-p">
                          <img
                            *ngIf="noti.isRead"
                            src="../../../assets/icons/Read.png"
                          />
                          <img
                            *ngIf="!noti.isRead"
                            src="../../../assets/icons/Unread.png"
                          />
                        </div>
                        <div class="noti-dot bg-s50"></div>
                        <div
                          class="status-p set-width"
                          [ngClass]="{
                            'status-read small text-c100': noti.isRead == true,
                            'status-unread caption text-c300':
                              noti.isRead == false
                          }"
                        >
                          {{ noti.createdTime }}
                        </div>
                      </div>
                    </div>
                    <div
                      class="noti-body"
                      [ngClass]="{
                        'body-read light-body-l text-c100': noti.isRead == true,
                        'body-unread body-l text-c300': noti.isRead == false
                      }"
                    >
                      {{ noti.message }}
                    </div>
                    <div
                      *ngIf="notification.noti.length - 1 > j"
                      class="inner-line"
                    ></div>
                  </div>
                  <div
                    [ngClass]="{
                      'outer-line': notifications.length - 1 > i,
                      'inner-line': notifications.length - 1 == i
                    }"
                  ></div>
                </div>
              </div>
            </div>

            <div
              class="d-flex pb-20"
              *ngIf="activeTab == 'activity' && !tabLoading"
            >
              <div class="firstCol">
                <div>
                  <h6 class="title-space body-xl">Ratings and reviews</h6>
                  <div>
                    <div
                      class="no-item body-m text-c100"
                      *ngIf="custDetail.ratings?.length <= 0"
                    >
                      There is no rating and review from this customer!
                    </div>
                    <div class="card-columns pl-0 pr-0">
                      <div
                        *ngFor="
                          let rating of custDetail.ratings
                            | slice
                              : 0
                              : [
                                  selectedId.indexOf('rating') != -1
                                    ? custDetail.ratings?.length
                                    : 2
                                ]
                        "
                        class="card card-wrap"
                      >
                        <div class="d-flex">
                          <ngb-rating
                            [(rate)]="rating.rating"
                            readonly="true"
                            max="5"
                          >
                            <ng-template let-fill="fill" let-index="index">
                              <span
                                *ngIf="fill === 100"
                                class="star"
                                [class.filled]="fill === 100"
                                >&#9733;</span
                              >
                              <span
                                *ngIf="fill !== 100"
                                class="star"
                                [class.notfilled]="fill !== 100"
                                >&#9734;</span
                              >
                            </ng-template>
                          </ngb-rating>
                          <span class="ml-auto small text-c100">{{
                            rating.updatedDate
                          }}</span>
                        </div>
                        <p
                          class="word-break body-m text-c100"
                          style="color: #2e3d4d"
                        >
                          <read-more
                            class="cust-readmore"
                            [text]="rating.message"
                          ></read-more>
                        </p>
                        <div class="d-flex info-wrap">
                          <div class="d-flex col-md-6 pl-0">
                            <div class="small-circular-image">
                              <img src="{{ rating.teacher_info.profilePic }}" />
                            </div>
                            <div class="padL-5">
                              <label class="small text-c100 mb-0"
                                >Teacher</label
                              >
                              <p
                                *ngIf="rating.teacher_info.preferredName"
                                class="caption text-c300 mb-0"
                              >
                                {{
                                  rating.teacher_info.preferredName.length > 20
                                    ? (rating.teacher_info.preferredName
                                        | slice: 0:20) + '...'
                                    : rating.teacher_info.preferredName
                                }}
                              </p>
                            </div>
                          </div>
                          <div class="timetable-col course-wrap col-md-6 pr-0">
                            <label class="small text-c100 mb-0">Course</label>
                            <p class="caption text-c300 mb-0">
                              {{ rating.course_info.name }}
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="btn-wrap">
                    <div *ngIf="custDetail.ratings?.length > 2">
                      <button
                        *ngIf="selectedId.indexOf('rating') == -1"
                        class="body-m text-b100 btn-showmore p-0"
                        (click)="showMoreItem('rating')"
                      >
                        <span>Show More</span
                        ><i
                          class="fa fa-angle-down body-l"
                          aria-hidden="true"
                        ></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div *ngIf="tabLoading" class="pb-20 w-100">
              <div class="title-space" style="height: 20px">
                <content-loader>
                  <svg:rect x="0" y="0" rx="3" ry="3" width="80%" height="15" />
                  <svg:rect
                    x="0"
                    y="20"
                    rx="3"
                    ry="3"
                    width="60%"
                    height="15"
                  />
                  <svg:rect
                    x="0"
                    y="40"
                    rx="3"
                    ry="3"
                    width="100%"
                    height="25"
                  />
                  <svg:rect
                    x="0"
                    y="75"
                    rx="3"
                    ry="3"
                    width="80%"
                    height="20"
                  />
                  <svg:rect
                    x="0"
                    y="100"
                    rx="3"
                    ry="3"
                    width="60%"
                    height="25"
                  />
                </content-loader>
              </div>
              <!-- <div class="title-space">
                <content-loader>
                  <svg:rect x="0" y="20" rx="3" ry="3" width="100%" height="25" />
                  <svg:rect x="0" y="50" rx="3" ry="3" width="80%" height="20" />
                  <svg:rect x="0" y="75" rx="3" ry="3" width="60%" height="25" />
                </content-loader>
              </div> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- loading start -->
  <div *ngIf="detailLoading" class="content-wrapper w-100">
    <div class="main-wrapper">
      <div class="top-profile-wrap">
        <div
          class="d-flex flex-column heading-space w-100"
          style="height: 180px"
        >
          <div class="d-flex justify-content-between">
            <div style="width: 200px">
              <content-loader
                [primaryColor]="'rgba(255, 255, 255, 0.25)'"
                [secondaryColor]="'rgba(0, 0, 0, 0.25)'"
              >
                <svg:rect x="0" y="0" rx="6" ry="6" width="100%" height="60" />
              </content-loader>
            </div>
            <div style="float: right; width: 200px">
              <content-loader
                [primaryColor]="'rgba(255, 255, 255, 0.25)'"
                [secondaryColor]="'rgba(0, 0, 0, 0.25)'"
              >
                <svg:rect x="0" y="0" rx="6" ry="6" width="100%" height="60" />
              </content-loader>
            </div>
          </div>
          <div class="d-flex justify-content-between">
            <div style="width: 500px">
              <content-loader
                [primaryColor]="'rgba(255, 255, 255, 0.25)'"
                [secondaryColor]="'rgba(0, 0, 0, 0.25)'"
              >
                <svg:rect
                  x="0"
                  y="0"
                  rx="50%"
                  ry="50%"
                  width="100"
                  height="100"
                />
              </content-loader>
            </div>
            <div style="float: right; width: 300px">
              <content-loader
                [primaryColor]="'rgba(255, 255, 255, 0.25)'"
                [secondaryColor]="'rgba(0, 0, 0, 0.25)'"
              >
                <svg:rect x="0" y="30" rx="6" ry="6" width="80%" height="20" />
                <svg:rect x="0" y="60" rx="6" ry="6" width="100%" height="25" />
              </content-loader>
            </div>
          </div>
        </div>
      </div>
      <div class="row section-wrap">
        <div class="d-flex flex-column profile-left col-md-4 col-xl-3 col-lg-3">
          <list-content-loader class="mt-4"></list-content-loader>
          <bullet-list-content-loader class="mt-3"></bullet-list-content-loader>
          <list-content-loader class="mt-4"></list-content-loader>
          <bullet-list-content-loader class="mt-3"></bullet-list-content-loader>
          <list-content-loader class="mt-4"></list-content-loader>
        </div>
        <div
          class="col-md-8 col-xl-9 col-lg-9 d-flex flex-column profile-right"
        >
          <bullet-list-content-loader></bullet-list-content-loader>
        </div>
      </div>
    </div>
  </div>
  <!-- loading end -->

  <ng-template #journalContent let-modal let-c="close" let-d="dismiss">
    <div class="modal-body" style="padding-top:0px !important;">
      <form>
        <div class="form-group">
          <div class="" style="padding-right:5px">
            <p class="cus-name body-m text-c100 col-md-10 mb-2">
              {{ custDetail.user.preferredName }}
            </p>
            <div class="journal_modal_close" (click)="closeModal()"></div>
          </div>

          <p
            class="h1-strong text-c300 col-md-12 mb-0"
            style="padding-bottom:8px;"
          >
            Progress book
          </p>
          <p class="class-name body-l text-c100 col-md-12">{{ className }}</p>
          <div class="no-journal" *ngIf="toShowNoJournl">
            <img
              class="no-journal-img"
              src="./assets/images/noJournal@2x.png"
            />
            <div
              class="body-l text-c100"
              style="top:65%;position:absolute;text-align: center;width:100%"
            >
              No Journal Yet
            </div>
          </div>
          <div class="bull-shit-gp">
            <div
              class="bull-shit"
              *ngFor="let journal of journals; let last = last"
            >
              <div
                class="row eachJournl"
                *ngIf="journal.type == 1 && !journal.teacherOnly"
              >
                <div class="journal-side-bar">
                  <div class="img-container bg-b25">
                    <img
                      class="journal-img"
                      src="./assets/images/msg-journal@2x.png"
                      style="width:22px !important"
                    />
                  </div>
                  <div class="side-line" [class.last-side-line]="last"></div>
                </div>

                <div class="journal-content" [class.border-bott]="last">
                  <div class="journal-header h3-strong text-c300">
                    Message
                    <div
                      class="d-flex align-items-center justify-content-end pt-2"
                    >
                      <p class="from mb-0 body-m text-c100">
                        from {{ journal.sender.preferredName }}
                      </p>
                      <p class="date body-m text-c300 float-right ml-auto mb-0">
                        {{ journal.updatedDate | date: 'd MMM y' }}
                      </p>
                      <span class="journal_delete_dotted"></span>
                      <span
                        class="journal_delete body-m text-r100"
                        (click)="
                          journalDeleteModal(journal, course, journal_delete)
                        "
                        >Delete</span
                      >
                    </div>
                  </div>
                  <div class="journal-detail body-l text-c300">
                    <p>
                      {{ journal.message }}
                    </p>
                    <img
                      class="message-img"
                      *ngIf="journal.photo != null"
                      src="{{ journal.photo }}"
                    />
                  </div>
                </div>
              </div>
              <div
                class="row eachJournl"
                *ngIf="journal.type == 1 && journal.teacherOnly"
              >
                <div class="journal-side-bar">
                  <div class="img-container bg-c25">
                    <img
                      class="journal-img"
                      src="./assets/images/private-padlock@2x.png"
                      style="width:14px;height:18px;margin-top:32%"
                    />
                  </div>
                  <div class="side-line" [class.last-side-line]="last"></div>
                </div>
                <div class="journal-content" [class.border-bott]="last">
                  <div class="journal-header h3-strong text-c300">
                    Private notes
                    <div
                      class="d-flex align-items-center justify-content-end pt-2"
                    >
                      <p class="from mb-0 body-m text-c100">
                        from {{ journal.sender.preferredName }}
                      </p>
                      <p class="date body-m text-c300 float-right mb-0 ml-auto">
                        {{ journal.updatedDate | date: 'd MMM y' }}
                      </p>
                      <span class="journal_delete_dotted"></span>
                      <span
                        class="journal_delete body-m text-r100"
                        (click)="
                          journalDeleteModal(journal, course, journal_delete)
                        "
                        >Delete</span
                      >
                    </div>
                  </div>
                  <div class="journal-detail body-l text-c300">
                    <p>
                      {{ journal.message }}
                    </p>
                    <img
                      class="message-img"
                      *ngIf="journal.photo != null"
                      src="{{ journal.photo }}"
                    />
                  </div>
                </div>
              </div>
              <div class="row eachJournl" *ngIf="journal.type == 2">
                <div class="journal-side-bar">
                  <div class="img-container bg-r25">
                    <img
                      class="journal-img"
                      src="./assets/images/journal-unpaid@2x.png"
                    />
                  </div>
                  <div class="side-line" [class.last-side-line]="last"></div>
                </div>
                <div class="journal-content" [class.border-bott]="last">
                  <div class="journal-header h3-strong text-c300">
                    Payment
                    <div
                      class="d-flex align-items-center justify-content-end pt-2"
                    >
                      <p class="from mb-0 body-m text-c100">
                        from {{ journal.sender.preferredName }}
                      </p>
                      <p class="date body-m text-c300 float-right mb-0 ml-auto">
                        {{ journal.updatedDate | date: 'd MMM y' }}
                      </p>
                      <span class="journal_delete_dotted"></span>
                      <span
                        class="journal_delete body-m text-r100"
                        (click)="
                          journalDeleteModal(journal, course, journal_delete)
                        "
                        >Delete</span
                      >
                    </div>
                  </div>
                  <div class="journal-detail body-l text-c300">
                    <p>
                      {{ journal.message }}
                    </p>
                    <img
                      class="message-img"
                      *ngIf="journal.photo != null"
                      src="{{ journal.photo }}"
                    />
                  </div>
                </div>
              </div>
              <div class="row eachJournl" *ngIf="journal.type == 3">
                <div class="journal-side-bar">
                  <div class="img-container bg-g25">
                    <img
                      class="journal-img"
                      src="./assets/images/journal-tick@2x.png"
                    />
                  </div>
                  <div class="side-line" [class.last-side-line]="last"></div>
                </div>
                <div class="journal-content" [class.border-bott]="last">
                  <div class="journal-header h3-strong text-c300">
                    Attendance
                    <div
                      class="d-flex align-items-center justify-content-end pt-2"
                    >
                      <p class="from mb-0 body-m text-c100">
                        from {{ journal.sender.preferredName }}
                      </p>
                      <p class="date body-m text-c300 float-right mb-0 ml-auto">
                        {{ journal.updatedDate | timezoneDate }}
                      </p>
                      <span class="journal_delete_dotted"></span>
                      <span
                        class="journal_delete body-m text-r100"
                        (click)="
                          journalDeleteModal(journal, course, journal_delete)
                        "
                        >Delete</span
                      >
                    </div>
                  </div>
                  <div class="journal-detail body-l text-c300">
                    <p>
                      {{ journal.message }}
                    </p>
                    <img
                      class="message-img"
                      *ngIf="journal.photo != null"
                      src="{{ journal.photo }}"
                    />
                  </div>
                  <div
                    class="attendance-time bg-s20"
                    [ngSwitch]="journal.type_detail.attendance"
                  >
                    <p class="atten-time body-m text-c100">
                      {{ journal.type_detail.date | utcTime }}
                    </p>
                    <img
                      class="attendance-img"
                      src="assets/images/journal-check@2x.png"
                      *ngSwitchCase="true"
                    />
                    <img
                      class="attendance-img"
                      src="assets/images/journalCross@2x.png"
                      *ngSwitchCase="false"
                    />
                    <img
                      class="attendance-img"
                      src="assets/images/journalMinus@2x.png"
                      *ngSwitchCase="null"
                    />
                  </div>
                </div>
              </div>

              <div
                class="row j-load-more body-m text-b100 bg-s0"
                *ngIf="toShowLoadMore && last"
                (click)="jLoadMore()"
              >
                <span style="margin-left:auto; margin-right: auto"
                  >Load more</span
                >
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </ng-template>

  <ng-template #classEnrollModal let-c="close" let-d="dismiss">
    <app-invoice
      *ngIf="showInvoice == true || showPaidInvoice == true"
      [custDetail]="custDetail"
      [course]="selectedCourse"
      [invoiceId]="invoiceID2"
      (closed)="closeModal('closeInv')"
      class="app-inv-wrap"
    >
    </app-invoice>
    <div class="overlayModal" *ngIf="showcb" (click)="clickOverlay()"></div>
    <div
      class="flexiModal"
      *ngIf="showInvoice == false && showflexyCourse == true"
    >
      <div class="innerFlexiModal">
        <div class="d-flex" style="margin: 20px 20px 0px 32px;">
          <div class="d-flex back" (click)="backtoCustomer()">
            <i class="fa fa-angle-left flexiBackicon body-xl text-c200"></i>
            <p class="mb-0 body-l text-c300 ">Add customer</p>
          </div>
          <button
            (click)="closeModal('close')"
            aria-label="Close"
            class="modal-close ml-auto"
            type="button"
          >
            <span class="closemark">
              <div class="closemark_stem"></div>
              <div class="closemark_kick"></div>
            </span>
          </button>
        </div>
        <app-flexi
          [flexyarr]="flexyarr"
          [selectedCustomer]="selectedCustomer"
          [course]="selectedCourse"
          [showcb]="showcb"
          (passDataconflictBoxShow)="conflictBoxShow($event)"
          (checkObjArr)="lessionObjArr($event)"
        >
        </app-flexi>
      </div>
      <div
        class="modal-footer d-flex justify-content-between"
        style=" padding: 18px 25px 18px 25px;box-shadow: 0px -2px 4px rgba(0, 0, 0, 0.08);"
      >
        <div class="d-flex flex-column">
          <div class="d-flex">
            <div class="toggle-wrap" (click)="this.isProrated = !isProrated">
              <label class="switch">
                <input
                  type="checkbox"
                  (click)="isProrated = !this.isProrated"
                  [checked]="isProrated"
                />
                <span class="slider round"></span>
              </label>
            </div>
            <label class="switch-label body-l text-c100" for="online"
              >Prorated</label
            >
          </div>
          <p class="defaultLessonCount body-m text-c100">
            Default lessons count: {{ selectedCourse.defaultlessonCount }}
          </p>
          <p class="textCount body-m text-c100">Number of lessons required:</p>
          <div class="selectedCountBox bg-b25 text-b300 body-m">
            <p class="selectedTest">
              Selected lessons: {{ checkobjArr.length }}
            </p>
          </div>
        </div>
        <div class="">
          <button
            type="button"
            class="btn modal-cancel-btn body-l bg-s0 text-c300"
            d-flex
            tab-section
            (click)="closeModal('close')"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="btn btn-submit body-l bg-b100 text-s0"
            *ngIf="checkobjArr.length != 0"
            (click)="flexicomfirm(invoiceAlert)"
          >
            Confirm
          </button>
          <button
            type="submit"
            *ngIf="checkobjArr.length == 0"
            class="btn btn-submit body-l bg-b100 text-s0"
            disabled
          >
            Confirm
          </button>
        </div>
      </div>
    </div>
    <div
      *ngIf="
        showInvoice == false &&
        showPayment == false &&
        showPaidInvoice == false &&
        showflexyCourse == false
      "
    >
      <div class="d-flex modal-header">
        <h3 class="modal-title text-c300 d-flex mr-auto">Enroll new class</h3>
        <div
          class="d-flex flex-column justify-content-center align-items-center mr-auto"
        >
          <div class="user-image">
            <img
              *ngIf="custDetail.user.profilePic == undefined"
              src="assets/img/user.svg"
            />
            <img
              *ngIf="custDetail.user.profilePic != undefined"
              src="{{ custDetail.user.profilePic }}"
            />
          </div>
          <p class="body-m text-c100 mb-0">
            {{ custDetail.user.preferredName }}
          </p>
        </div>
        <button
          (click)="closeModal('close')"
          aria-label="Close"
          class="modal-close ml-auto"
          type="button"
        >
          <span class="closemark">
            <div class="closemark_stem"></div>
            <div class="closemark_kick"></div>
          </span>
        </button>
      </div>
      <form novalidate #cfees="ngForm">
        <div class="modal-body confirm-text">
          <div class="d-flex flex-column mt-37" style="position: relative;">
            <div class="d-flex">
              <input
                class="form-control py-2 input-search-bg bg-s20 body-l"
                type="search"
                placeholder="Search class"
                id="example-search-input"
                name="search"
                #search="ngModel"
                [(ngModel)]="searchData.searchText"
                (input)="
                  changeSearch2($event.target.value, custDetail.user.userId)
                "
                (keyup.enter)="
                  changeSearch(
                    $event.target.value,
                    custDetail.user.userId,
                    '',
                    ''
                  )
                "
              />
              <span
                class="input-group-append"
                (click)="
                  changeSearch(
                    searchData.searchText,
                    custDetail.user.userId,
                    '',
                    ''
                  )
                "
              >
                <button
                  class="bt btn-design btn-outline-secondary btn-right-radius"
                  type="button"
                >
                  <i class="fa fa-search search-size h3-strong text-c200"></i>
                </button>
              </span>
            </div>
          </div>
          <div *ngIf="noSetting == true" class="seat-taken body-m text-r100">
            You should set invoice setting and payment setting first.
          </div>
          <div class="mt-20 mb40 class-group">
            <div class="card-columns pd-zero">
              <div
                class="card"
                *ngFor="let course of availableCourses; let i = index"
              >
                <div class="single-class">
                  <div
                    class="no-seat small bg-s20 text-c100"
                    *ngIf="course.seat_left == 0"
                  >
                    All seat taken
                  </div>
                  <div
                    class="seat-left small text-s0 bg-b100"
                    *ngIf="course.seat_left != 0 && course.seat_left != null"
                  >
                    {{ course.seat_left }} seats left
                  </div>
                  <div
                    class="seat-left small text-s0 bg-b100"
                    *ngIf="course.seat_left == null"
                  >
                    unlimited seats
                  </div>
                  <div class="class-info-head">
                    <h5 class="mt-03 small text-c100">
                      <i class="fa fa-map-marker" style="font-size:15px"></i>
                      {{ course.location.name }}
                    </h5>
                    <b class="h3-strong text-c300">{{ course.name }}</b>
                  </div>
                  <div class="class-info-body">
                    <div
                      [hidden]="
                        !course.paymentPolicy.courseFee &&
                        !course.paymentPolicy.deposit &&
                        !course.paymentPolicy.miscFee &&
                        !course.paymentPolicy.proratedLessonFee
                      "
                      class="class-body-one row bg-s20"
                    >
                      <div
                        class="col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-6"
                      >
                        <div *ngIf="course.paymentPolicy.courseFee != null">
                          <h5 class="light-body-m text-c100">Course fee</h5>
                          <sup class="caption text-c300">{{
                            currency.invCurrencySign
                          }}</sup
                          ><b class="body-l text-c300">{{
                            course.paymentPolicy.courseFee
                          }}</b>
                        </div>
                        <div
                          *ngIf="course.paymentPolicy.proratedLessonFee != null"
                          class="mt-16"
                        >
                          <h5 class="light-body-m text-c100">
                            Prorate class fee
                          </h5>
                          <sup class="caption text-c300">{{
                            currency.invCurrencySign
                          }}</sup
                          ><b class="body-l text-c300">{{
                            course.paymentPolicy.proratedLessonFee
                          }}</b>
                        </div>
                      </div>
                      <div
                        class="col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-6 pl-zero"
                      >
                        <div>
                          <div *ngIf="course.paymentPolicy.deposit">
                            <h5 class="light-body-m text-c100">Deposit</h5>
                            <sup class="caption text-c300">{{
                              currency.invCurrencySign
                            }}</sup
                            ><b class="body-l text-c300">{{
                              course.paymentPolicy.deposit.amount
                            }}</b>
                          </div>
                        </div>
                        <div
                          class="mt-16"
                          *ngIf="course.paymentPolicy.miscFee != null"
                        >
                          <h5 class="light-body-m text-c100">
                            Miscellaneous fee
                          </h5>
                          <sup class="caption text-c300">{{
                            currency.invCurrencySign
                          }}</sup
                          ><b class="body-l text-c300">{{
                            course.paymentPolicy.miscFee
                          }}</b>
                        </div>
                      </div>
                    </div>
                    <div class="class-body-two row">
                      <div
                        *ngIf="course.type != 'ONLINE'"
                        class="col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-6"
                      >
                        <b
                          class="body-m text-c300"
                          *ngFor="let day of course.repeatDays | weekDays"
                          >{{ day }}</b
                        >
                        <h5
                          class="light-body-m text-c100"
                          *ngIf="
                            course.duration != undefined &&
                            course.duration.endDate != undefined
                          "
                        >
                          {{ course.duration.startDate | utcTime }} -
                          {{ course.duration.endDate | utcTime }}
                        </h5>
                      </div>
                      <div
                        class="col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-6 pl-zero"
                      >
                        <div class="d-flex detail-fees">
                          <div
                            class="col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-6 pl-zero pr-03"
                          >
                            <h5 class="light-body-m text-c100">From</h5>
                            <b class="body-m text-c300">{{
                              course.startDate | utcDate
                            }}</b>
                          </div>
                          <div
                            class="col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-6 pl-zero pr-zero"
                          >
                            <h5
                              class="light-body-m text-c100 mt-03"
                              *ngIf="course.endDate != null"
                            >
                              To
                            </h5>
                            <h5
                              class="light-body-m text-c100 pt-24"
                              *ngIf="course.endDate == null"
                            ></h5>
                            <b
                              class="body-m text-c300"
                              *ngIf="course.endDate"
                              >{{ course.endDate | utcDate }}</b
                            >

                            <b
                              class="body-m text-c300"
                              *ngIf="course.endDate == null"
                              >{{
                                course.type == 'FLEXY'
                                  ? course.lessons.length
                                  : course.lessonCount
                              }}
                              Lessons</b
                            >
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    class="row d-flex justify-content-center class-info-footer"
                  >
                    <button
                      type="button"
                      class="btn body-m text-b100"
                      (click)="enrollUser(course, course.type, invoiceAlert)"
                      [disabled]="course.isDisabled || noSetting == true"
                    >
                      Enroll on this course
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div
              *ngIf="availableCourses.length >= 20 && acResult?.length > 0"
              class="load-more1 bg-s0 d-flex justify-content-center"
            >
              <button
                type="button"
                class="btn body-m bg-s0 text-b100"
                (click)="
                  showMoreAC(availableCourses.length, custDetail.user.userId)
                "
              >
                load more
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>

    <div *ngIf="showPayment == true">
      <div class="invoice-container">
        <div class="logo-wrapper">
          <img src="{{ logo }}" />
        </div>
        <div class="mt-40">
          <label class="payment-label body-xl text-c300"
            >Choose payment method</label
          >
          <div class="d-flex mt-1">
            <div
              class="payment-item "
              *ngFor="let provider of paymentProviders"
            >
              <label
                [ngClass]="{
                  'selectedItem text-s0 bg-b100':
                    selectedPayment == provider.name,
                  'text-c300 bg-s0': selectedPayment != provider.name
                }"
                class="form-check-label body-l"
              >
                <input
                  class="form-check-input"
                  type="radio"
                  name="payment"
                  id="payment1"
                  value="provider.name"
                  [(ngModel)]="paymentItem.type"
                  #payment="ngModel"
                  (click)="choosePayment(provider)"
                />
                {{ provider.name }}
              </label>
            </div>
          </div>
          <div>
            <form #paymentForm="ngForm" nonvalidate>
              <div class="mt-30">
                <label class="payment-label body-xl text-c300"
                  >Reference number</label
                >
                <div>
                  <input
                    type="text"
                    name="ref"
                    class="w-75 cash-input text-c75 bg-s20"
                    placeholder="Reference number"
                    [(ngModel)]="paymentItem.refNumber"
                    #refNumber="ngModel"
                  />
                </div>
              </div>
              <div class="mt-30">
                <label class="payment-label body-xl text-c300">Amount</label>
                <div class="d-flex popup-input w-75">
                  <div class="input-sign light-body-l text-c100">
                    {{ currency.invCurrencySign }}
                  </div>
                  <input
                    type="number"
                    name="amount"
                    class="w-100 cash-input text-c75 bg-s20"
                    placeholder="0"
                    [(ngModel)]="paymentItem.amount"
                    #amount="ngModel"
                    required
                  />
                </div>
                <div
                  *ngIf="amount.invalid && (amount.dirty || amount.touched)"
                  class="alert alert-danger alert-m-right w-75 mt-3"
                >
                  <div [hidden]="!amount.errors.required">
                    Amount is required!
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div
        *ngIf="selectedPayment != ''"
        class="modal-footer d-flex justify-content-between payment-footer"
      >
        <button
          class="back-inv body-l text-c300 cursor-on"
          (click)="backToInvoice()"
        >
          <i class="fa fa-angle-left h3-strong text-c200"></i><span>Back</span>
        </button>
        <button
          class="btn btn-submit body-l bg-b100 text-s0 cursor-on"
          (click)="payNow(selectedPayment)"
          [disabled]="
            paymentItem.amount == '' ||
            paymentItem.amount == undefined ||
            paymentItem.amount <= 0
          "
        >
          Pay now
        </button>
      </div>
    </div>
  </ng-template>

  <ng-template #claimModal let-c="close" let-d="dismiss">
    <div class="modal-header d-flex justify-content-between">
      <div>
        <p class="valid-until body-m text-c100">
          Valid until
          <span
            >{{ currentPassObj.expirationDate.day }}
            {{ currentPassObj.expirationDate.month - 1 | TTmonth }}
            {{ currentPassObj.expirationDate.year }}</span
          >
        </p>
        <h3 class="modal-title text-c300">{{ currentPassObj.name }}</h3>
      </div>
      <button
        type="button"
        class="close"
        aria-label="Close"
        (click)="closeModal('close')"
      >
        <span class="closepass">
          <div class="closepass_stem"></div>
          <div class="closepass_kick"></div>
        </span>
      </button>
    </div>
    <div class="modal-body confirm-text">
      <div>
        <input
          type="search"
          name=""
          class="form-control course-search-input body-l"
          placeholder="Search courses"
          (input)="searchMakeup_input($event.target.value)"
          (keyup.enter)="searchMakeup($event.target.value)"
        />
      </div>
      <div class="mt-20 class-group" style="margin-bottom: 20px;">
        <div class="card-columns pd-zero" *ngIf="claimCourses">
          <div class="card" *ngFor="let claim of claimCourses; let i = index">
            <div class="single-class">
              <div
                class="no-seat small bg-s20 text-c100"
                *ngIf="claim.seat_left == 0"
              >
                All seat taken
              </div>
              <div
                class="seat-left small text-s0 bg-b100"
                *ngIf="claim.seat_left != 0 && claim.seat_left != null"
              >
                {{ claim.seat_left }} seats left
              </div>
              <div
                class="seat-left small text-s0 bg-b100"
                *ngIf="claim.seat_left == null"
              >
                unlimited seats
              </div>
              <div class="class-info-head">
                <h5 class="mt-03 small text-c100">
                  <i class="fa fa-map-marker" style="font-size:15px"></i>
                  {{ claim.location.name }}
                </h5>
                <b class="h3-strong text-c300">{{ claim.name }}</b
                ><br />
                <label class="makeup-plan small text-c100">
                  <span *ngIf="claim.startTime"
                    >{{ claim.startTime.hr | timeFormat }} :
                    {{ claim.startTime.min | timeFormat }}
                    {{ claim.startTime.meridiem }}</span
                  >
                  -
                  <span *ngIf="claim.endTime"
                    >{{ claim.endTime.hr | timeFormat }} :
                    {{ claim.endTime.min | timeFormat }}
                    {{ claim.endTime.meridiem }}</span
                  >
                </label>
              </div>
              <div class="d-flex flex-column count-wrap w-100 bg-s20">
                <div class="d-flex justify-content-between">
                  <p class="valid-until body-m text-c100">
                    Pick a date to claim makeup pass
                  </p>
                  <div>
                    <img
                      src="./assets/img/chevron-right-s.png"
                      (click)="backward('timeline-' + i)"
                      class="mr-32"
                    />
                    <img
                      src="./assets/img/chevron-left-s.png"
                      (click)="forward('timeline-' + i)"
                    />
                  </div>
                </div>

                <div id="timeline-{{ i }}" class="timeline">
                  <div
                    *ngFor="let lesson of claim.lessons"
                    class=" form-check-inline tool-checked"
                  >
                    <label
                      *ngIf="lesson && lesson._id"
                      [ngClass]="{
                        'selected bg-b100 text-s0': isChecked == lesson._id
                      }"
                      [ngClass]="{ 'bg-s0': isChecked != lesson._id }"
                      class="form-check-label light-body-l"
                    >
                      <input
                        class="form-check-input"
                        type="radio"
                        name="passForm"
                        id="course"
                        value="{{ lesson }}"
                        [(ngModel)]="passForm.lesson"
                        #course="ngModel"
                        [checked]="false"
                        (click)="chooseDate(lesson, claim)"
                      />
                      <p class="xxxdate body-m text-c300">
                        {{ lesson.startDate | timelineDate }}
                      </p>
                      <p class="xxxday small text-c100">
                        {{ lesson.startDate | timelineDay }}
                      </p>
                    </label>
                  </div>
                </div>
              </div>
              <div class="row d-flex justify-content-center class-info-footer">
                <button
                  type="button"
                  class="btn enroll-button body-l"
                  [ngClass]="{ 'text-c300': checkCourse == claim.courseId }"
                  (click)="enrollPass(claim, currentPassObj.course.courseId)"
                  [disabled]="checkCourse != claim.courseId"
                >
                  Claim class
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div
        *ngIf="
          claimCourses?.length >= 20 && mkResult?.length > 0 && !mkSearchFlag
        "
        class="load-more1 bg-s0 d-flex justify-content-center"
      >
        <button
          type="button"
          class="btn body-m bg-s0 text-b100"
          (click)="showMoreMakeup(claimCourses.length)"
        >
          load more
        </button>
      </div>
    </div>
  </ng-template>

  <ng-template #invoiceAlert>
    <div class="modal-header">
      <h3 class="modal-title text-c300">Generate invoice</h3>
    </div>
    <div class="modal-body apg-confirm">
      <p>
        Do you want to generate invoice for this enrollment?
        <span class="target"></span>
      </p>
    </div>
    <div class="modal-footer invoiceAlert-footer">
      <button
        type="button"
        class="btn modal-cancel-btn body-l bg-s0 text-c300"
        (click)="cancelInvoiceAlert()"
      >
        No
      </button>
      <button
        type="submit"
        class="btn modal-delete-btn bg-b100 text-s0 body-l"
        (click)="confirmInvoiceAlert()"
      >
        Yes
      </button>
    </div>
  </ng-template>

  <ng-template #remainingLessons>
    <div style="overflow: auto; height: 767px;" id="rm-parent">
      <div class="d-flex modal-header">
        <h3 class="body-m text-c100">{{ custDetail.user.preferredName }}</h3>
        <span class="cross_close" (click)="closeModal('')"></span>
      </div>
      <div class="modal-body lessons_body">
        <div class="d-flex flex-column">
          <h3 class="h1-strong text-c300">Remaining lesson</h3>
          <p class="pb-0 light-body-l text-c100">{{ lessonOfStudent.name }}</p>
        </div>
        <div *ngIf="!headerFixed" class="rm-header text-c100">
          <div class="d-flex align-items-center" style="width: 40%;">
            DATE
            <div *ngIf="!attendedFlag" class="rm-count text-y300 small">
              <span
                class="d-flex align-items-center"
                *ngIf="lessonOfStudent.upComingLessonCountOfStudent > 1"
              >
                <span class="text-y200 caption">Upcoming</span>
                <div class="yellow-dot"></div>
                {{ lessonOfStudent.upComingLessonCountOfStudent }} lessons
                left</span
              ><span
                class="d-flex align-items-center"
                *ngIf="lessonOfStudent.upComingLessonCountOfStudent <= 1"
              >
                <span class="text-y200 caption">Upcoming</span>
                <div class="yellow-dot"></div>
                {{ lessonOfStudent.upComingLessonCountOfStudent }} lesson
                left</span
              >
            </div>
            <div *ngIf="attendedFlag" class="rm-count-0 text-c100 caption">
              Attended
            </div>
          </div>
          <div class="d-flex align-items-center" style="width: 30%;">
            STATUS
          </div>
          <div class="d-flex align-items-center" style="width: 30%;">
            TEACHER
          </div>
        </div>
        <div *ngIf="headerFixed" class="rm-header-fixed text-c100">
          <div
            class="d-flex align-items-center"
            style="width: 40%;margin-left: 24px;"
          >
            DATE
            <div *ngIf="!attendedFlag" class="rm-count text-y300 small">
              <span
                class="d-flex align-items-center"
                *ngIf="lessonOfStudent.upComingLessonCountOfStudent > 1"
              >
                <span class="text-y200 caption">Upcoming</span>
                <div class="yellow-dot"></div>
                {{ lessonOfStudent.upComingLessonCountOfStudent }} lessons
                left</span
              ><span
                class="d-flex align-items-center"
                *ngIf="lessonOfStudent.upComingLessonCountOfStudent <= 1"
              >
                <span class="text-y200 caption">Upcoming</span>
                <div class="yellow-dot"></div>
                {{ lessonOfStudent.upComingLessonCountOfStudent }} lesson
                left</span
              >
            </div>
            <div *ngIf="attendedFlag" class="rm-count-0 text-c100 caption">
              Attended
            </div>
          </div>
          <div class="d-flex align-items-center" style="width: 30%;">
            STATUS
          </div>
          <div class="d-flex align-items-center" style="width: 30%;">
            TEACHER
          </div>
        </div>
        <div class="rm-container" id="rm-container">
          <!-- upcoming -->
          <div
            class="rm-lesson"
            *ngFor="let lesson of lessonOfStudent.upComingLessonsOfStudent"
          >
            <div class="h5-strong text-c300" style="width: 40%;">
              {{ lesson.startDate | remainingLessonDate
              }}<span
                class="rm-auto small text-c100"
                *ngIf="lesson.autoEnrolledLesson"
                >Auto enrolled lesson</span
              ><span class="rm-auto small text-c100" *ngIf="lesson.makeup"
                >Makeup lesson</span
              ><span
                class="rm-auto small text-c100"
                *ngIf="lesson.rescheduledLesson"
                >Reschedued lesson</span
              >
            </div>
            <div style="width: 30%;" *ngIf="lesson.cancel == true">
              <div class="rm-cancel text-y300 body-m">
                <img
                  class="mr-6"
                  src="../../../../assets/img/rm_cancel.png"
                />Cancelled
              </div>
            </div>
            <div
              style="width: 30%;"
              *ngIf="lesson.attendance == true && lesson.cancel == false"
            >
              <div class="rm-present text-g200 body-m">
                <img
                  class="mr-6"
                  src="../../../../assets/img/rm_present.png"
                />Present
              </div>
            </div>
            <div
              style="width: 30%;"
              *ngIf="lesson.attendance == false && lesson.cancel == false"
            >
              <div class="rm-absent text-r100 body-m">
                <img
                  class="mr-6"
                  src="../../../../assets/img/rm_absent.png"
                />Absent
              </div>
            </div>
            <!-- <div
              style="width: 30%;"
              *ngIf="
                lesson.attendance == null &&
                !lesson.isUpcomingLesson &&
                lesson.cancel == false
              "
            >
              <div class="rm-nodata text-c100 body-m">
                <img
                  class="mr-6"
                  src="../../../../assets/img/rm_nodata.png"
                />No data
              </div>
            </div> -->
            <div
              style="width: 30%;"
              *ngIf="lesson.attendance == null && lesson.cancel == false"
            >
              <div class="rm-unavail text-s70 body-m">
                <img
                  class="mr-6"
                  src="../../../../assets/img/rm_unavail.png"
                />Not avaliable
              </div>
            </div>
            <div
              class="d-flex align-items-center light-body-m text-c300"
              style="width: 30%;"
            >
              <div>
                <img
                  class="rm-profile mr-3"
                  src="{{ lesson.teacher?.profilePic }}"
                />
              </div>
              {{ lesson.teacher?.preferredName }}
            </div>
          </div>
          <div id="the-line"></div>
          <!-- prev -->
          <div
            class="rm-lesson"
            *ngFor="let lesson of lessonOfStudent.prevLessonsOfStudent"
          >
            <div class="h5-strong text-c300" style="width: 40%;">
              {{ lesson.startDate | remainingLessonDate
              }}<span
                class="rm-auto small text-c100"
                *ngIf="lesson.autoEnrolledLesson"
                >Auto enrolled lesson</span
              ><span class="rm-auto small text-c100" *ngIf="lesson.makeup"
                >Makeup lesson</span
              ><span
                class="rm-auto small text-c100"
                *ngIf="lesson.rescheduledLesson"
                >Reschedued lesson</span
              >
            </div>
            <div style="width: 30%;" *ngIf="lesson.cancel == true">
              <div class="rm-cancel text-y300 body-m">
                <img
                  class="mr-6"
                  src="../../../../assets/img/rm_cancel.png"
                />Cancelled
              </div>
            </div>
            <div
              style="width: 30%;"
              *ngIf="lesson.attendance == true && lesson.cancel == false"
            >
              <div class="rm-present text-g200 body-m">
                <img
                  class="mr-6"
                  src="../../../../assets/img/rm_present.png"
                />Present
              </div>
            </div>
            <div
              style="width: 30%;"
              *ngIf="lesson.attendance == false && lesson.cancel == false"
            >
              <div class="rm-absent text-r100 body-m">
                <img
                  class="mr-6"
                  src="../../../../assets/img/rm_absent.png"
                />Absent
              </div>
            </div>
            <div
              style="width: 30%;"
              *ngIf="
                lesson.attendance == null &&
                !lesson.isUpcomingLesson &&
                lesson.cancel == false
              "
            >
              <div class="rm-nodata text-c100 body-m">
                <img
                  class="mr-6"
                  src="../../../../assets/img/rm_nodata.png"
                />No data
              </div>
            </div>
            <div
              style="width: 30%;"
              *ngIf="
                lesson.isUpcomingLesson &&
                lesson.attendance == null &&
                lesson.cancel == false
              "
            >
              <div class="rm-unavail text-s70 body-m">
                <img
                  class="mr-6"
                  src="../../../../assets/img/rm_unavail.png"
                />Not avaliable
              </div>
            </div>
            <div
              class="d-flex align-items-center light-body-m text-c300"
              style="width: 30%;"
            >
              <div>
                <img
                  class="rm-profile mr-3"
                  src="{{ lesson.teacher?.profilePic }}"
                />
              </div>
              {{ lesson.teacher?.preferredName }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template #auto_Enroll>
    <h3
      class="modal-title enroll_title h3-strong text-c300"
      *ngIf="!tempCourse.autoEnroll"
    >
      Enable automatic enrollment
    </h3>
    <h3
      class="modal-title enroll_title h3-strong text-c300"
      *ngIf="tempCourse.autoEnroll"
    >
      Disable automatic enrollment
    </h3>
    <div class="autoEnroll-body">
      <p
        *ngIf="!tempCourse.autoEnroll"
        class="auto_enroll_body light-body-l text-c300"
      >
        Enabling this will allow automatic assigment of lessons to the student
        once the current payment term ends. This will also generate a new
        invoice if the invoice option is available.
      </p>
      <p
        *ngIf="tempCourse.autoEnroll"
        class="auto_enroll_body light-body-l text-c300"
      >
        Disabling this will cancel the automatic assignment of lessons to the
        student once the current payment term ends. You will still be able to
        assign new lessons manually.
      </p>
    </div>
    <div class="modal-footer autoEnroll-footer">
      <button
        type="button"
        class="btn modal-cancel-btn body-l bg-s0 text-c300"
        (click)="cancelAutoEnroll()"
      >
        Cancel
      </button>
      <button
        type="submit"
        class="btn modal-delete-btn bg-b100 text-s0 body-l"
        (click)="confirmAutoEnroll()"
        *ngIf="!tempCourse.autoEnroll"
      >
        Enable
      </button>
      <button
        type="submit"
        class="btn modal-delete-btn bg-b100 text-s0 body-l"
        (click)="confirmAutoEnroll()"
        *ngIf="tempCourse.autoEnroll"
      >
        Disable
      </button>
    </div>
  </ng-template>

  <ng-template #journal_delete>
    <h3 class="modal-title enroll_title h3-strong text-c300">
      Confirm delete?
    </h3>
    <div class="autoEnroll-body">
      <p class="light-body-l text-c300">
        Are you sure you want to delete? You wont back it return.
      </p>
    </div>
    <div class="modal-footer autoEnroll-footer">
      <button
        type="button"
        class="btn modal-cancel-btn body-l bg-s0 text-c300"
        (click)="cancelAutoEnroll()"
      >
        Cancel
      </button>
      <button
        *ngIf="deleteGradeId == null"
        type="submit"
        class="btn modal-delete-btn bg-r100 text-s0 body-l"
        (click)="confirmJournalDelete()"
      >
        Delete
      </button>
      <button
        *ngIf="deleteGradeId != null"
        type="submit"
        class="btn modal-delete-btn bg-r100 text-s0 body-l"
        (click)="deleteGrade()"
      >
        Yes
      </button>
    </div>
  </ng-template>

  <ng-template #archive_modal>
    <h3 class="modal-title enroll_title h3-strong text-c300">
      Confirm archive?
    </h3>
    <div class="autoEnroll-body">
      <p class="light-body-l text-c300">
        Are you sure you want to archive?
      </p>
    </div>
    <div class="modal-footer autoEnroll-footer">
      <button
        type="button"
        class="btn modal-cancel-btn body-l bg-s0 text-c300"
        (click)="cancelAutoEnroll()"
      >
        Cancel
      </button>
      <button
        type="submit"
        class="btn modal-delete-btn bg-b100 text-s0 body-l"
        (click)="confirmJournalDelete()"
      >
        Yes
      </button>
    </div>
  </ng-template>
  <div
    class="overlayModal "
    *ngIf="showPickGradeBox"
    (click)="clickOverlay()"
  ></div>

  <ng-template #pickGradeModal>
    <div class="justify-content-center align-items-center grade-pickup-modal">
      <p class="grade-change small text-c100">Change grade for</p>
      <p class="body-l text-c300">{{ apgName }}</p>
      <div
        *ngFor="let option of gradeOptions"
        class="apg-group d-flex align-items-center justify-content-between"
        (click)="selectAPG(option)"
      >
        <div
          class="option-point body-m d-flex justify-content-center align-items-center"
          [ngStyle]="{ color: color, background: bgcolor }"
          [ngClass]="option.isSelected ? 'highlight-point' : ''"
        >
          <span>{{ option.point }}</span>
        </div>
        <div
          class="option-name body-l d-flex align-items-center justify-content-start"
          [ngClass]="option.isSelected ? 'text-b100' : 'text-c300'"
        >
          <span>{{ option.name }}</span>
        </div>
      </div>
      <div class="btn-group">
        <button
          (click)="cancelGradePickUp()"
          style="margin-right: 10px;"
          class="btn modal-cancel-btn body-l bg-s0 text-c300"
        >
          Cancel
        </button>
        <button
          class="btn btn-submit body-l bg-b100 text-s0"
          (click)="updateAPG()"
        >
          Update
        </button>
      </div>
    </div>
  </ng-template>

  <div class="custom_backdrop" *ngIf="isJournal_delete"></div>
  <!-- <block-ui message="Deafult Message"></block-ui> -->
</div>

<ng-template #editMakeup let-c="close" let-d="dismiss">
  <div class="modal-body modal-wrap">
    <h3 class="text-c100 light-body-l">
      Edit valid date
    </h3>
    <div class="input-wrap">
      <div class="cc-start">
        <span class="dp-icon2">
          <img src="../../../../assets/img/course-dp.png" />
        </span>
        <input
          [disabled]="activePass == 'claimed'"
          [ngClass]="activePass == 'claimed' ? 'not-allowed' : ''"
          type="text"
          placeholder="Edit date"
          class="input-day2 dropD startInput body-m text-c300"
          name="start"
          required
          (click)="start.toggle()"
          [(ngModel)]="editMakeUpDate"
          ngbDatepicker
          #start="ngbDatepicker"
          (document:click)="closeDropdown($event, 'start', start)"
          readonly
        />
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-between m-3">
    <button
      class="btn elevation-2y text-r100 body-m bg-s0 btn-makeup"
      (click)="deleteMakeUp()"
    >
      Delete
    </button>
    <div class="d-flex">
      <button
        class="btn bg-s20 text-c100 body-m btn-makeup mr-3"
        (click)="makeupModalClose()"
      >
        Cancel
      </button>
      <button
        class="btn bg-b100 text-s0 body-m btn-makeup"
        (click)="editMakeupDate()"
        [disabled]="activePass == 'claimed'"
      >
        Edit
      </button>
    </div>
  </div>
</ng-template>

<ng-template #classTransferModal let-c="close" let-d="dismiss">
  <app-invoice
    *ngIf="showInvoice == true || showPaidInvoice == true"
    [custDetail]="custDetail"
    [course]="selectedCourse"
    [invoiceId]="invoiceID2"
    (closed)="closeModal('closeInv')"
    class="app-inv-wrap"
  >
  </app-invoice>
  <div class="overlayModal" *ngIf="showcb" (click)="clickOverlay()"></div>
  <div
    class="flexiModal"
    *ngIf="showInvoice == false && showflexyCourse == true"
  >
    <div class="innerFlexiModal">
      <div class="d-flex" style="margin: 20px 20px 0px 32px;">
        <div class="d-flex back" (click)="backtoCustomer()">
          <i class="fa fa-angle-left flexiBackicon body-xl text-c200"></i>
          <p class="mb-0 body-l text-c300 ">Add customer</p>
        </div>
        <button
          (click)="closeModal('close')"
          aria-label="Close"
          class="modal-close ml-auto"
          type="button"
        >
          <span class="closemark">
            <div class="closemark_stem"></div>
            <div class="closemark_kick"></div>
          </span>
        </button>
      </div>
      <app-flexi
        [transfer]="true"
        [flexyarr]="flexyarr"
        [selectedCustomer]="selectedCustomer"
        [course]="selectedCourse"
        [showcb]="showcb"
        (passDataconflictBoxShow)="conflictBoxShow($event)"
        (checkObjArr)="lessionObjArr($event)"
      >
      </app-flexi>
    </div>
    <div
      class="modal-footer d-flex justify-content-between"
      style=" padding: 18px 25px 18px 25px;box-shadow: 0px -2px 4px rgba(0, 0, 0, 0.08);"
    >
      <div class="d-flex flex-column">
        <div class="d-flex">
          <div class="toggle-wrap" (click)="this.isProrated = !isProrated">
            <label class="switch">
              <input
                type="checkbox"
                (click)="isProrated = !this.isProrated"
                [checked]="isProrated"
              />
              <span class="slider round"></span>
            </label>
          </div>
          <label class="switch-label body-l text-c100" for="online"
            >Prorated</label
          >
        </div>
        <p class="defaultLessonCount body-m text-c100">
          Default lessons count: {{ selectedCourse.defaultlessonCount }}
        </p>
        <p class="textCount body-m text-c100">Number of lessons required:</p>
        <div class="selectedCountBox bg-b25 text-b300 body-m">
          <p class="selectedTest">Selected lessons: {{ checkobjArr.length }}</p>
        </div>
      </div>
      <div class="">
        <button
          type="button"
          class="btn modal-cancel-btn body-l bg-s0 text-c300"
          d-flex
          tab-section
          (click)="closeModal('close')"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="btn btn-submit body-l bg-b100 text-s0"
          *ngIf="checkobjArr.length != 0"
          (click)="flexicomfirm(undefined)"
        >
          Confirm
        </button>
        <button
          type="submit"
          *ngIf="checkobjArr.length == 0"
          class="btn btn-submit body-l bg-b100 text-s0"
          disabled
        >
          Confirm
        </button>
      </div>
    </div>
  </div>
  <div
    *ngIf="
      showInvoice == false &&
      showPayment == false &&
      showPaidInvoice == false &&
      showflexyCourse == false
    "
  >
    <div class="d-flex modal-header">
      <h3 class="modal-title text-c300 d-flex mr-auto">Transfer class</h3>
      <div
        class="d-flex flex-column justify-content-center align-items-center mr-auto"
      >
        <div class="user-image">
          <img
            *ngIf="custDetail.user.profilePic == undefined"
            src="assets/img/user.svg"
          />
          <img
            *ngIf="custDetail.user.profilePic != undefined"
            src="{{ custDetail.user.profilePic }}"
          />
        </div>
        <p class="body-m text-c100 mb-0">
          {{ custDetail.user.preferredName }}
        </p>
      </div>
      <button
        (click)="closeModal('close')"
        aria-label="Close"
        class="modal-close ml-auto"
        type="button"
      >
        <span class="closemark">
          <div class="closemark_stem"></div>
          <div class="closemark_kick"></div>
        </span>
      </button>
    </div>
    <form novalidate #cfees="ngForm">
      <div class="modal-body confirm-text">
        <div class="d-flex flex-column mt-37" style="position: relative;">
          <div class="d-flex">
            <input
              class="form-control py-2 input-search-bg bg-s20 body-l"
              type="search"
              placeholder="Search class"
              id="example-search-input"
              name="search"
              #search="ngModel"
              [(ngModel)]="searchData.searchText"
              (input)="
                changeSearch2($event.target.value, custDetail.user.userId)
              "
              (keyup.enter)="
                changeSearch(
                  $event.target.value,
                  custDetail.user.userId,
                  '',
                  ''
                )
              "
            />
            <span
              class="input-group-append"
              (click)="
                changeSearch(
                  searchData.searchText,
                  custDetail.user.userId,
                  '',
                  ''
                )
              "
            >
              <button
                class="bt btn-design btn-outline-secondary btn-right-radius"
                type="button"
              >
                <i class="fa fa-search search-size h3-strong text-c200"></i>
              </button>
            </span>
          </div>
        </div>
        <div *ngIf="noSetting == true" class="seat-taken body-m text-r100">
          You should set invoice setting and payment setting first.
        </div>
        <div class="mt-20 mb40 class-group">
          <div class="card-columns pd-zero">
            <div
              class="card"
              *ngFor="let course of availableCourses; let i = index"
            >
              <div class="single-class">
                <div
                  class="no-seat small bg-s20 text-c100"
                  *ngIf="course.seat_left == 0"
                >
                  All seat taken
                </div>
                <div
                  class="seat-left small text-s0 bg-b100"
                  *ngIf="course.seat_left != 0 && course.seat_left != null"
                >
                  {{ course.seat_left }} seats left
                </div>
                <div
                  class="seat-left small text-s0 bg-b100"
                  *ngIf="course.seat_left == null"
                >
                  unlimited seats
                </div>
                <div class="class-info-head">
                  <h5 class="mt-03 small text-c100">
                    <i class="fa fa-map-marker" style="font-size:15px"></i>
                    {{ course.location.name }}
                  </h5>
                  <b class="h3-strong text-c300">{{ course.name }}</b>
                </div>
                <div class="class-info-body">
                  <div
                    [hidden]="
                      !course.paymentPolicy.courseFee &&
                      !course.paymentPolicy.deposit &&
                      !course.paymentPolicy.miscFee &&
                      !course.paymentPolicy.proratedLessonFee
                    "
                    class="class-body-one row bg-s20"
                  >
                    <div class="col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-6">
                      <div *ngIf="course.paymentPolicy.courseFee != null">
                        <h5 class="light-body-m text-c100">Course fee</h5>
                        <sup class="caption text-c300">{{
                          currency.invCurrencySign
                        }}</sup
                        ><b class="body-l text-c300">{{
                          course.paymentPolicy.courseFee
                        }}</b>
                      </div>
                      <div
                        *ngIf="course.paymentPolicy.proratedLessonFee != null"
                        class="mt-16"
                      >
                        <h5 class="light-body-m text-c100">
                          Prorate class fee
                        </h5>
                        <sup class="caption text-c300">{{
                          currency.invCurrencySign
                        }}</sup
                        ><b class="body-l text-c300">{{
                          course.paymentPolicy.proratedLessonFee
                        }}</b>
                      </div>
                    </div>
                    <div
                      class="col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-6 pl-zero"
                    >
                      <div>
                        <div *ngIf="course.paymentPolicy.deposit">
                          <h5 class="light-body-m text-c100">Deposit</h5>
                          <sup class="caption text-c300">{{
                            currency.invCurrencySign
                          }}</sup
                          ><b class="body-l text-c300">{{
                            course.paymentPolicy.deposit.amount
                          }}</b>
                        </div>
                      </div>
                      <div
                        class="mt-16"
                        *ngIf="course.paymentPolicy.miscFee != null"
                      >
                        <h5 class="light-body-m text-c100">
                          Miscellaneous fee
                        </h5>
                        <sup class="caption text-c300">{{
                          currency.invCurrencySign
                        }}</sup
                        ><b class="body-l text-c300">{{
                          course.paymentPolicy.miscFee
                        }}</b>
                      </div>
                    </div>
                  </div>
                  <div class="class-body-two row">
                    <div
                      *ngIf="course.type != 'ONLINE'"
                      class="col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-6"
                    >
                      <b
                        class="body-m text-c300"
                        *ngFor="let day of course.repeatDays | weekDays"
                        >{{ day }}</b
                      >
                      <h5
                        class="light-body-m text-c100"
                        *ngIf="
                          course.duration != undefined &&
                          course.duration.endDate != undefined
                        "
                      >
                        {{ course.duration.startDate | utcTime }} -
                        {{ course.duration.endDate | utcTime }}
                      </h5>
                    </div>
                    <div
                      class="col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-6 pl-zero"
                    >
                      <div class="d-flex detail-fees">
                        <div
                          class="col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-6 pl-zero pr-03"
                        >
                          <h5 class="light-body-m text-c100">From</h5>
                          <b class="body-m text-c300">{{
                            course.startDate | utcDate
                          }}</b>
                        </div>
                        <div
                          class="col-sm-6 col-md-6 col-lg-6 col-xl-6 col-xxl-6 pl-zero pr-zero"
                        >
                          <h5
                            class="light-body-m text-c100 mt-03"
                            *ngIf="course.endDate != null"
                          >
                            To
                          </h5>
                          <h5
                            class="light-body-m text-c100 pt-24"
                            *ngIf="course.endDate == null"
                          ></h5>
                          <b class="body-m text-c300" *ngIf="course.endDate">{{
                            course.endDate | utcDate
                          }}</b>

                          <b
                            class="body-m text-c300"
                            *ngIf="course.endDate == null"
                            >{{
                              course.type == 'FLEXY'
                                ? course.lessons.length
                                : course.lessonCount
                            }}
                            Lessons</b
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div
                  class="row d-flex justify-content-center class-info-footer"
                >
                  <button
                    type="button"
                    class="btn body-m text-b100"
                    (click)="enrollUser(course, course.type, undefined)"
                    [disabled]="course.isDisabled || noSetting == true"
                  >
                    Transfer to this course
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div
            *ngIf="availableCourses.length >= 20 && acResult?.length > 0"
            class="load-more1 bg-s0 d-flex justify-content-center"
          >
            <button
              type="button"
              class="btn body-m bg-s0 text-b100"
              (click)="
                showMoreAC(availableCourses.length, custDetail.user.userId)
              "
            >
              load more
            </button>
          </div>
        </div>
      </div>
    </form>
  </div>

  <div *ngIf="showPayment == true">
    <div class="invoice-container">
      <div class="logo-wrapper">
        <img src="{{ logo }}" />
      </div>
      <div class="mt-40">
        <label class="payment-label body-xl text-c300"
          >Choose payment method</label
        >
        <div class="d-flex mt-1">
          <div class="payment-item " *ngFor="let provider of paymentProviders">
            <label
              [ngClass]="{
                'selectedItem text-s0 bg-b100':
                  selectedPayment == provider.name,
                'text-c300 bg-s0': selectedPayment != provider.name
              }"
              class="form-check-label body-l"
            >
              <input
                class="form-check-input"
                type="radio"
                name="payment"
                id="payment1"
                value="provider.name"
                [(ngModel)]="paymentItem.type"
                #payment="ngModel"
                (click)="choosePayment(provider)"
              />
              {{ provider.name }}
            </label>
          </div>
        </div>
        <div>
          <form #paymentForm="ngForm" nonvalidate>
            <div class="mt-30">
              <label class="payment-label body-xl text-c300"
                >Reference number</label
              >
              <div>
                <input
                  type="text"
                  name="ref"
                  class="w-75 cash-input text-c75 bg-s20"
                  placeholder="Reference number"
                  [(ngModel)]="paymentItem.refNumber"
                  #refNumber="ngModel"
                />
              </div>
            </div>
            <div class="mt-30">
              <label class="payment-label body-xl text-c300">Amount</label>
              <div class="d-flex popup-input w-75">
                <div class="input-sign light-body-l text-c100">
                  {{ currency.invCurrencySign }}
                </div>
                <input
                  type="number"
                  name="amount"
                  class="w-100 cash-input text-c75 bg-s20"
                  placeholder="0"
                  [(ngModel)]="paymentItem.amount"
                  #amount="ngModel"
                  required
                />
              </div>
              <div
                *ngIf="amount.invalid && (amount.dirty || amount.touched)"
                class="alert alert-danger alert-m-right w-75 mt-3"
              >
                <div [hidden]="!amount.errors.required">
                  Amount is required!
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div
      *ngIf="selectedPayment != ''"
      class="modal-footer d-flex justify-content-between payment-footer"
    >
      <button
        class="back-inv body-l text-c300 cursor-on"
        (click)="backToInvoice()"
      >
        <i class="fa fa-angle-left h3-strong text-c200"></i><span>Back</span>
      </button>
      <button
        class="btn btn-submit body-l bg-b100 text-s0 cursor-on"
        (click)="payNow(selectedPayment)"
        [disabled]="
          paymentItem.amount == '' ||
          paymentItem.amount == undefined ||
          paymentItem.amount <= 0
        "
      >
        Pay now
      </button>
    </div>
  </div>
</ng-template>
